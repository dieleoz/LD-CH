# üèóÔ∏è ARQUITECTURA COMPLETA: De DT a Layout

**Proyecto:** APP La Dorada - Chiriguan√°  
**Versi√≥n:** 1.0  
**Fecha:** 11 de Octubre 2025  
**Tipo:** Documento de Arquitectura Integral  
**Estado:** üü° **PARCIALMENTE IMPLEMENTADO**

---

## üìã **RESUMEN EJECUTIVO**

Este documento describe el **flujo completo end-to-end** desde que un especialista propone un cambio t√©cnico (DT) hasta que se refleja en TODOS los niveles del sistema, incluyendo el **Layout de equipos** y el **men√∫ WBS visual**.

### **Pregunta que responde:**

> "Si te paso una DT donde ahora las antenas TETRA son a criterio de 30% de solapamiento (en vez de 20%), ¬øc√≥mo recalculas y ubicas equipos, cantidad, actualizas la documentaci√≥n y 'pintas' el men√∫/layout?"

---

## üîÑ **SISTEMA ACTUAL: 6 NIVELES DE PROPAGACI√ìN**

### **Seg√∫n las reglas del proyecto (.cursorrules):**

Cuando se ejecuta una DT, los cambios deben propagarse en **6 NIVELES**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  NIVEL 1: IX. WBS Y PLANIFICACI√ìN ‚úÖ OBLIGATORIO           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  - WBS_Presupuestal_v2.0.md (cantidades, VU, totales)      ‚îÇ
‚îÇ  - datos_wbs_TODOS_items.json (datos completos)            ‚îÇ
‚îÇ  - wbs_metadata_enriquecida.json (metadata t√©cnica)        ‚îÇ
‚îÇ  - Interfaces HTML (visualizaci√≥n)                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  NIVEL 2: V. INGENIER√çA DE DETALLE ‚ö†Ô∏è CONDICIONAL         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  - V.X_Sistema_Detalle_vX.md (secci√≥n t√©cnica espec√≠fica)  ‚îÇ
‚îÇ  Ejemplo: DT-TETRA-002 ‚Üí V.3 Comunicaciones ¬ß4.2           ‚îÇ
‚îÇ  Script: actualizar_documentos_detalle.ps1                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  NIVEL 3: III. INGENIER√çA CONCEPTUAL ‚ö†Ô∏è SI APLICA         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  - 27_Sistema_TETRA_Integrado.md                           ‚îÇ
‚îÇ  - Criterios y cantidades conceptuales                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  NIVEL 4: VIII. DOCUMENTOS MAESTROS ‚úÖ OBLIGATORIO         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  - CRITERIOS_TECNICOS_MAESTRO_v1.0.md                      ‚îÇ
‚îÇ  - MATRIZ_TRAZABILIDAD_TECNICA_v1.0.md                     ‚îÇ
‚îÇ  - MATRIZ_DEPENDENCIAS_DOCUMENTALES_v1.0.md                ‚îÇ
‚îÇ  Script: actualizar_documentos_maestros.ps1                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  NIVEL 5: X. ENTREGABLES CONSOLIDADOS ‚ö†Ô∏è SI EXISTE        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  - SISTEMA_02_Telecomunicaciones_Master.md                 ‚îÇ
‚îÇ  Script: cocinar.ps1                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  NIVEL 6: √çNDICES ‚úÖ OBLIGATORIO                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  - Indice_Maestro_Consolidado_v1.0.md                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
                      CLIENTE
```

---

## üö® **PROBLEMA DETECTADO: LAYOUT NO EST√Å EN LOS 6 NIVELES**

### **Lo que FALTA (no implementado):**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  NIVEL 7: LAYOUT Y UBICACIONES ‚ùå FALTA IMPLEMENTAR        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  - VIII/LAYOUT_MAESTRO_EQUIPOS_v1.0.md                     ‚îÇ
‚îÇ  - IX/WBS_Layout_Maestro.html (interfaz visual)            ‚îÇ
‚îÇ  Script: actualizar_layout_desde_DT.ps1 ‚ùå NO EXISTE       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Actualmente:**
- El layout.md es **EST√ÅTICO** (lo creaste manualmente)
- **NO se actualiza** autom√°ticamente cuando ejecutas DTs
- **NO recalcula** ubicaciones cuando cambian cantidades
- **NO se sincroniza** con el sistema de propagaci√≥n

---

## üí° **EJEMPLO CONCRETO: DT-TETRA-030 (Cambio Solapamiento)**

### **Escenario:**

Especialista propone:
> "Cambiar criterio de solapamiento TETRA de 20% a 30% para mejorar cobertura en zonas monta√±osas"

---

### **PASO 1: CREAR DT-TETRA-030-2025-10-11.md**

```yaml
dt_metadata:
  id: "DT-TETRA-030"
  fecha: "2025-10-11"
  item_wbs: "2.1.100"
  tipo_cambio: "criterio_tecnico"
  impacto: "recalculo_cantidad_y_ubicaciones"

criterios_modificados:
  - nombre: "Solapamiento_Cobertura_TETRA"
    valor_anterior: "20%"
    valor_nuevo: "30%"
    justificacion: "Mejorar cobertura en zonas monta√±osas seg√∫n an√°lisis topogr√°fico"

recalculo_automatico:
  - parametro: "cantidad_estaciones_tetra"
    formula_anterior: "594 km √∑ (15 km √ó (1 - 0.20)) = 594 √∑ 12 = 49.5 ‚âà 37 estaciones"
    formula_nueva: "594 km √∑ (15 km √ó (1 - 0.30)) = 594 √∑ 10.5 = 56.6 ‚âà 57 estaciones"
    cantidad_anterior: 37
    cantidad_nueva: 57
    diferencia: +20 estaciones

archivos_actualizar:
  # NIVEL 1: WBS
  - file: "IX. WBS y Planificacion/WBS_Presupuestal_v2.0.md"
    seccion: "Item 2.1.100 - Torres TETRA/GSM-R"
    cambios:
      - campo: "cantidad"
        buscar: "37"
        reemplazar: "57"
      - campo: "total_cop"
        buscar: "antiguo_total"
        reemplazar: "nuevo_total"
        recalcular: true
        formula: "57 √ó VU_torre"

  # NIVEL 2: Ingenier√≠a de Detalle
  - file: "V.3_Sistemas_Comunicacion_Detalle_v5.0.md"
    seccion: "¬ß4.2 Cobertura TETRA"
    cambios:
      - campo: "criterio_solapamiento"
        buscar: "20% entre estaciones"
        reemplazar: "30% entre estaciones"
      - campo: "cantidad_estaciones"
        buscar: "37 estaciones"
        reemplazar: "57 estaciones"

  # NIVEL 3: Ingenier√≠a Conceptual
  - file: "III. Ingenieria conceptual/27_Sistema_TETRA_Integrado_v5.0.md"
    seccion: "¬ß3.1 Dimensionamiento"
    cambios:
      - campo: "cantidad_tetra"
        buscar: "37"
        reemplazar: "57"

  # NIVEL 4: Documentos Maestros
  - file: "VIII/CRITERIOS_TECNICOS_MAESTRO_v1.0.md"
    accion: "agregar_criterio"
    nuevo_criterio:
      id: "CRIT-TETRA-030"
      nombre: "Solapamiento Cobertura TETRA"
      valor: "30%"
      norma: "An√°lisis topogr√°fico espec√≠fico del corredor"
      origen_dt: "DT-TETRA-030"

  # üÜï NIVEL 7: LAYOUT (NO IMPLEMENTADO A√öN)
  - file: "VIII/LAYOUT_MAESTRO_EQUIPOS_v1.0.md"
    accion: "recalcular_ubicaciones"
    parametros:
      tipo_equipo: "TELECOMUNICACIONES"
      dispositivo: "TETRA BS"
      cantidad_anterior: 37
      cantidad_nueva: 57
      metodo_recalculo: "distribucion_uniforme"
      pk_inicio: "201+470"
      pk_fin: "722+250"
      distancia_nueva: "594 km √∑ 57 = 10.42 km"
    salida:
      - regenerar_filas_tabla
      - mantener_estaciones_criticas
      - distribuir_nuevas_uniformemente

  # üÜï NIVEL 8: WBS LAYOUT HTML (NO IMPLEMENTADO)
  - file: "IX/WBS_Layout_Maestro.html"
    accion: "regenerar_desde_layout_maestro"
    script: "generar_layout_html_REORGANIZADO.ps1"

  # NIVEL 5: Entregables Consolidados
  - file: "X/7_SISTEMAS_EJECUTIVOS/SISTEMA_02_Telecomunicaciones_EJECUTIVO.md"
    accion: "cocinar_y_servir"
    scripts:
      - "cocinar.ps1 -Sistema 02"
      - "servir.ps1 -Sistema 02"
```

---

## üîß **LO QUE ACTUALMENTE NO HACEMOS (Y DEBER√çAMOS):**

### **1. Recalcular Ubicaciones de Equipos** ‚ùå

**Situaci√≥n actual:**
- DT cambia cantidad 37 ‚Üí 57 estaciones TETRA
- WBS se actualiza (presupuesto)
- Documentos se actualizan (descripci√≥n)
- **PERO layout.md NO se recalcula** ‚ùå

**Lo que deber√≠a pasar:**
```powershell
# Script que NO existe:
.\scripts\recalcular_layout_desde_DT.ps1 -DT "DT-TETRA-030"

# Deber√≠a:
1. Leer DT y detectar cambio de cantidad
2. Leer layout.md y encontrar equipos tipo "TETRA BS"
3. Recalcular distribuci√≥n:
   - Distancia anterior: 12 km (37 estaciones)
   - Distancia nueva: 10.42 km (57 estaciones)
4. Generar nuevas filas de tabla con PKs recalculados
5. Actualizar layout.md
6. Regenerar WBS_Layout_Maestro.html
```

---

### **2. Validar Coherencia Layout ‚Üî DTs** ‚ùå

**Situaci√≥n actual:**
- Layout tiene 700 balizas Eurobalise
- DT-CTC-001 dice "filosof√≠a virtual" (sin se√±ales f√≠sicas)
- **NO hay validaci√≥n** de esta contradicci√≥n

**Lo que deber√≠a pasar:**
```powershell
# Script que NO existe:
.\scripts\validar_coherencia_layout.ps1

# Deber√≠a:
1. Leer todas las DTs ejecutadas
2. Leer layout.md
3. Comparar:
   - Si DT dice "virtual" ‚Üí Balizas NO deber√≠an estar en layout
   - Si DT dice "37 TETRA" ‚Üí Layout debe tener exactamente 37 TETRA
4. Generar reporte de inconsistencias
5. Proponer correcciones
```

---

### **3. Actualizar "Pintura" del Men√∫** ‚ö†Ô∏è PARCIAL

**Lo que S√ç hacemos:**
- Actualizar estad√≠sticas en `WBS_Menu_Principal.html` (presupuesto, kilometraje, etc.)

**Lo que NO hacemos:**
- Actualizar estad√≠sticas de layout en tiempo real
- Reflejar cambios de ubicaciones en interfaz
- Mostrar "√öltima DT aplicada afect√≥ 20 equipos del layout"

---

## üéØ **FLUJO COMPLETO PROPUESTO (Como DEBER√çA Funcionar)**

### **Ejemplo: DT-TETRA-030 (Solapamiento 20% ‚Üí 30%)**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PASO 1: ESPECIALISTA PROPONE CAMBIO                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Especialista:
  "Cambiar solapamiento TETRA de 20% a 30%"
  "Raz√≥n: An√°lisis topogr√°fico muestra zonas monta√±osas"
  "Impacto: +20 estaciones (37 ‚Üí 57)"

        ‚Üì

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PASO 2: CREAR DT CON YAML EXTENDIDO                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

DT-TETRA-030-2025-10-11.md
  - Secciones 1-9: Contexto, justificaci√≥n, riesgos
  - Secci√≥n 10: YAML con:
    ‚úÖ archivos_actualizar (6 niveles actuales)
    üÜï layout_actualizar (nueva secci√≥n)
    üÜï recalculo_ubicaciones (nueva secci√≥n)

        ‚Üì

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PASO 3: CURSOR EJECUTA DT (Autom√°tico)                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

3.1 Actualiza NIVEL 1: WBS
    ‚îú‚îÄ WBS_Presupuestal: 37 ‚Üí 57 estaciones
    ‚îú‚îÄ Recalcula presupuesto
    ‚îî‚îÄ Actualiza datos_wbs_TODOS_items.json

3.2 Actualiza NIVEL 2: Detalle
    ‚îú‚îÄ V.3_Comunicaciones: ¬ß4.2 "30% solapamiento"
    ‚îî‚îÄ Versiona v5.0 ‚Üí v5.1

3.3 Actualiza NIVEL 3: Conceptual
    ‚îî‚îÄ 27_Sistema_TETRA: Cantidad 37 ‚Üí 57

3.4 Actualiza NIVEL 4: Maestros
    ‚îú‚îÄ CRITERIOS_TECNICOS: Agrega "Solapamiento 30%"
    ‚îî‚îÄ MATRIZ_TRAZABILIDAD: DT-TETRA-030 ‚Üí 5 docs

3.5 üÜï Actualiza NIVEL 7: LAYOUT ‚≠ê NUEVO
    ‚îú‚îÄ Ejecuta: recalcular_layout_desde_DT.ps1
    ‚îú‚îÄ Lee layout.md actual
    ‚îú‚îÄ Encuentra 37 estaciones TETRA (EBT_01 a EBT_26, etc.)
    ‚îú‚îÄ RECALCULA ubicaciones:
    ‚îÇ  F√≥rmula anterior: PK cada 12 km
    ‚îÇ  F√≥rmula nueva: PK cada 10.42 km
    ‚îú‚îÄ Genera 20 nuevas filas de tabla:
    ‚îÇ  | UFV | PK | Tipo | Dispositivo | Nombre |
    ‚îÇ  | UFV24 | 215+000 | TELECOM | TETRA BS | EBT_27 | (nueva)
    ‚îÇ  | UFV25 | 225+400 | TELECOM | TETRA BS | EBT_28 | (nueva)
    ‚îÇ  ...
    ‚îú‚îÄ Actualiza layout.md (37 ‚Üí 57 filas tipo TETRA)
    ‚îî‚îÄ Versiona layout v1.1 ‚Üí v1.2

3.6 üÜï Actualiza NIVEL 8: WBS VISUAL ‚≠ê NUEVO
    ‚îú‚îÄ Ejecuta: generar_layout_html_REORGANIZADO.ps1
    ‚îú‚îÄ Regenera WBS_Layout_Maestro.html
    ‚îú‚îÄ Ahora muestra 57 estaciones (antes 37)
    ‚îú‚îÄ Estad√≠sticas actualizadas:
    ‚îÇ  Total Equipos: 396 ‚Üí 416 (+20)
    ‚îÇ  Tipo TELECOM: 87 ‚Üí 107 (+20)
    ‚îî‚îÄ Interfaz "pintada" con nuevos equipos

        ‚Üì

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PASO 4: COCINAR (Consolidar a X/7_EJECUTIVOS)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

.\scripts\cocinar.ps1 -Sistema 02

Resultado:
  - SISTEMA_02_Telecomunicaciones_EJECUTIVO.md actualizado
  - Incluye: "57 estaciones TETRA con 30% solapamiento"

        ‚Üì

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PASO 5: SERVIR (Exportar a Word/HTML + Layout)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

.\scripts\servir.ps1 -Sistema 02

Resultado:
  - SISTEMA_02_...EJECUTIVO.docx generado
  - Contiene:
    ‚úÖ Descripci√≥n: "57 estaciones con 30% solapamiento"
    ‚úÖ ANEXO Layout: Tabla con 57 estaciones + PKs actualizados
  - Layout INYECTADO autom√°ticamente desde layout.md actualizado

        ‚Üì

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PASO 6: CLIENTE VE RESULTADO FINAL                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Cliente recibe:
  ‚úÖ Word con descripci√≥n t√©cnica actualizada
  ‚úÖ Tabla layout con 57 estaciones ubicadas
  ‚úÖ PKs recalculados seg√∫n nuevo criterio
  ‚úÖ TODO COHERENTE desde 1 DT
```

---

## üìä **COMPARATIVA: Actual vs Propuesto**

| Nivel | Descripci√≥n | Actual | Propuesto |
|:------|:------------|:-------|:----------|
| **1** | WBS (cantidades, $) | ‚úÖ Implementado | ‚úÖ Funciona |
| **2** | Ingenier√≠a Detalle | ‚úÖ Implementado | ‚úÖ Funciona |
| **3** | Ingenier√≠a Conceptual | ‚úÖ Implementado | ‚úÖ Funciona |
| **4** | Documentos Maestros | ‚úÖ Implementado | ‚úÖ Funciona |
| **5** | Entregables Consolid. | ‚úÖ Implementado (cocinar.ps1) | ‚úÖ Funciona |
| **6** | √çndices | ‚úÖ Implementado | ‚úÖ Funciona |
| **7** | **LAYOUT (ubicaciones)** | ‚ùå **NO existe** | üÜï **Por implementar** |
| **8** | **WBS Visual (HTML)** | ‚ö†Ô∏è **Manual** | üÜï **Por automatizar** |

---

## üîß **LO QUE NECESITAMOS IMPLEMENTAR:**

### **Script 1: recalcular_layout_desde_DT.ps1** ‚ùå NO EXISTE

**Prop√≥sito:** Recalcular ubicaciones de equipos cuando cambian cantidades

**L√≥gica:**

```powershell
param(
    [string]$DT_ID,              # Ej: DT-TETRA-030
    [string]$TipoEquipo,         # Ej: TELECOMUNICACIONES
    [string]$Dispositivo,        # Ej: TETRA BS
    [int]$CantidadAnterior,      # Ej: 37
    [int]$CantidadNueva,         # Ej: 57
    [string]$MetodoDistribucion  # Ej: "uniforme" o "criterio_tecnico"
)

# 1. Leer layout.md actual
$layout = Get-Content "layout.md"

# 2. Encontrar filas del equipo afectado
$filasTE TRA = $layout | Where-Object { $_ -match 'TETRA BS' }
# Resultado: 37 filas encontradas

# 3. Calcular nueva distribuci√≥n
$pkInicio = "201+470"
$pkFin = "722+250"
$distanciaTotal = 520.78 km  # (722.250 - 201.470)
$distanciaNueva = $distanciaTotal / $CantidadNueva
# = 520.78 / 57 = 9.14 km por estaci√≥n

# 4. Generar nuevas ubicaciones PK
$nuevasEstaciones = @()
$pkActual = 201.470

for ($i = 1; $i -le $CantidadNueva; $i++) {
    $ufv = Calcular-UFV($pkActual)
    $nuevaEstacion = @{
        UFV = $ufv
        PK = Format-PK($pkActual)
        Tipo = "TELECOMUNICACIONES"
        Dispositivo = "TETRA BS"
        Nombre = "EBT_$($i.ToString('00'))"
    }
    $nuevasEstaciones += $nuevaEstacion
    $pkActual += 9.14
}

# 5. Reemplazar filas en layout.md
# Eliminar 37 filas antiguas TETRA
# Insertar 57 filas nuevas TETRA
# Mantener orden por PK

# 6. Guardar layout.md actualizado
# Versionar: v1.1 ‚Üí v1.2

# 7. Regenerar WBS_Layout_Maestro.html
.\scripts\generar_layout_html_REORGANIZADO.ps1
```

---

### **Script 2: validar_coherencia_layout_DTs.ps1** ‚ùå NO EXISTE

**Prop√≥sito:** Validar que layout.md concuerda con DTs ejecutadas

**L√≥gica:**

```powershell
# 1. Leer todas las DTs ejecutadas
$dts = Get-ChildItem "II. Apendices Tecnicos/Decisiones_Tecnicas/DT-*.md"

# 2. Construir "estado esperado" desde DTs
$estadoEsperado = @{
    "TETRA_BS" = 37  # Seg√∫n DT-TETRA-001
    "ATP_Embarcado" = 8  # Seg√∫n DT-TETRA-001
    "Balizas_Eurobalise" = 0  # Seg√∫n DT-CTC-001 (filosof√≠a virtual)
    ...
}

# 3. Leer layout.md y contar equipos reales
$layoutReal = Parse-Layout("layout.md")
$equiposReales = @{
    "TETRA_BS" = ($layoutReal | Where-Object { $_.Dispositivo -eq "TETRA BS" }).Count
    "ATP_Embarcado" = ($layoutReal | Where-Object { $_.Dispositivo -eq "ATP" }).Count
    "Balizas_Eurobalise" = ($layoutReal | Where-Object { $_.Dispositivo -eq "Eurobalise" }).Count
}

# 4. Comparar esperado vs real
$inconsistencias = @()

foreach ($equipo in $estadoEsperado.Keys) {
    if ($estadoEsperado[$equipo] -ne $equiposReales[$equipo]) {
        $inconsistencias += @{
            Equipo = $equipo
            Esperado = $estadoEsperado[$equipo]
            Real = $equiposReales[$equipo]
            Diferencia = $equiposReales[$equipo] - $estadoEsperado[$equipo]
        }
    }
}

# 5. Generar reporte
Write-Host "INCONSISTENCIAS DETECTADAS:" -ForegroundColor Red
$inconsistencias | Format-Table

# Ejemplo salida:
# Equipo              Esperado  Real  Diferencia
# ------              --------  ----  ----------
# Balizas_Eurobalise        0   700         +700  ‚ùå ERROR
# TETRA_BS                 37    37            0  ‚úÖ OK
# ATP_Embarcado             8    15           +7  ‚ùå ERROR
```

---

### **Script 3: actualizar_menu_wbs_desde_layout.ps1** ‚ùå NO EXISTE

**Prop√≥sito:** Actualizar estad√≠sticas del men√∫ WBS cuando cambia el layout

**L√≥gica:**

```powershell
# 1. Parsear layout.md
$equipos = Parse-Layout("layout.md")

# 2. Calcular estad√≠sticas
$stats = @{
    TotalEquipos = $equipos.Count
    UFVUnicas = ($equipos | Select-Object -Unique UFV).Count
    TiposTelecom = ($equipos | Where-Object { $_.Tipo_Equipo -eq "TELECOMUNICACIONES" }).Count
    # ...
}

# 3. Actualizar WBS_Menu_Principal.html
$menu = Get-Content "IX/WBS_Menu_Principal.html"

# Buscar secci√≥n de estad√≠sticas de layout
# Reemplazar n√∫meros con $stats calculadas

# Ejemplo:
# ANTES:
#   <div class="summary-item">
#       <div class="number">800+</div>
#       <div class="label">Equipos en Layout</div>
#   </div>
#
# DESPU√âS:
#   <div class="summary-item">
#       <div class="number">$($stats.TotalEquipos)</div>
#       <div class="label">Equipos en Layout</div>
#   </div>

# 4. Guardar men√∫ actualizado
```

---

## üéØ **FLUJO ACTUAL vs FLUJO IDEAL**

### **LO QUE HACEMOS HOY (Implementado):**

```
DT creada
  ‚Üì
Cursor ejecuta DT
  ‚Üì
Actualiza 6 niveles:
  1. WBS (cantidades, $)
  2. V. Detalle
  3. III. Conceptual
  4. VIII. Maestros
  5. X. Consolidados (cocinar.ps1)
  6. √çndices
  ‚Üì
servir.ps1 ‚Üí Word/HTML
  ‚Üì
Layout EST√ÅTICO inyectado (no recalculado) ‚ö†Ô∏è
```

---

### **LO QUE DEBER√çAMOS HACER (Propuesto):**

```
DT creada
  ‚Üì
Cursor ejecuta DT
  ‚Üì
Actualiza 6 niveles actuales
  ‚Üì
üÜï NIVEL 7: Recalcula Layout
  ‚îú‚îÄ recalcular_layout_desde_DT.ps1
  ‚îú‚îÄ Nuevas ubicaciones PK
  ‚îú‚îÄ Actualiza layout.md
  ‚îî‚îÄ Versiona layout (v1.1 ‚Üí v1.2)
  ‚Üì
üÜï NIVEL 8: Regenera WBS Visual
  ‚îú‚îÄ generar_layout_html_REORGANIZADO.ps1
  ‚îú‚îÄ WBS_Layout_Maestro.html actualizado
  ‚îî‚îÄ Estad√≠sticas reflejadas en men√∫
  ‚Üì
cocinar.ps1 ‚Üí Consolida
  ‚Üì
servir.ps1 ‚Üí Word/HTML
  ‚Üì
Layout DIN√ÅMICO inyectado (recalculado) ‚úÖ
```

---

## üìù **EJEMPLO DE DT EXTENDIDA CON LAYOUT:**

```yaml
# DT-TETRA-030-2025-10-11.md
# Secci√≥n 10: INSTRUCCIONES PARA CURSOR

dt_metadata:
  id: "DT-TETRA-030"
  fecha: "2025-10-11"
  item_wbs: "2.1.100"
  tipo_cambio: "criterio_recalculo"
  impacto_layout: true  # üÜï Flag que indica cambio de ubicaciones

archivos_actualizar:
  # ... (6 niveles actuales) ...

# üÜï NUEVA SECCI√ìN: Layout
layout_recalcular:
  activar: true
  tipo_equipo_afectado: "TELECOMUNICACIONES"
  dispositivo_especifico: "TETRA BS"
  criterio_cambio:
    parametro: "solapamiento_cobertura"
    valor_anterior: "20%"
    valor_nuevo: "30%"
  
  cantidad_equipos:
    anterior: 37
    nueva: 57
    diferencia: +20
  
  metodo_redistribucion: "uniforme_con_estaciones_fijas"
  estaciones_fijas_mantener:
    - PK: "201+470"  # M√©xico
    - PK: "441+932"  # B/Bermejo
    - PK: "722+250"  # Chiriguan√°
  
  distribuir_entre_fijos: true
  distancia_nueva_promedio: "10.42 km"
  
  acciones_layout:
    - accion: "eliminar_filas_antiguas"
      criterio: "Dispositivo='TETRA BS'"
      cantidad_esperada: 37
      
    - accion: "generar_filas_nuevas"
      cantidad: 57
      algoritmo: "distribucion_uniforme"
      pk_inicio: "201+470"
      pk_fin: "722+250"
      mantener_puntos_fijos: true
      
    - accion: "actualizar_switches_acceso"
      patron_nomenclatura: "SWA_[UBICACION]_01"
      
    - accion: "versionar_layout"
      version_actual: "v1.1"
      version_nueva: "v1.2"
      nota: "DT-TETRA-030: Recalculo 37‚Üí57 estaciones (30% solapamiento)"

# üÜï NUEVA SECCI√ìN: WBS Visual
wbs_visual_actualizar:
  activar: true
  archivos:
    - file: "IX/WBS_Layout_Maestro.html"
      metodo: "regenerar_desde_layout_md"
      script: "generar_layout_html_REORGANIZADO.ps1"
      
    - file: "IX/WBS_Menu_Principal.html"
      seccion: "Tarjeta LAYOUT MAESTRO"
      actualizar_estadisticas:
        - campo: "Total Equipos"
          valor_anterior: "396"
          valor_nuevo: "416"
        - campo: "Equipos TELECOM"
          valor_anterior: "87"
          valor_nuevo: "107"
```

---

## üîÑ **C√ìMO FUNCIONAR√çA EL SISTEMA COMPLETO:**

### **Tu pregunta:** "Si te paso una DT con solapamiento 30%..."

### **Mi respuesta (Flujo ideal):**

```
1. T√ö creas: DT-TETRA-030-2025-10-11.md
   (Con YAML extendido incluyendo secci√≥n layout_recalcular)

2. YO (Cursor) ejecuto la DT:
   
   a) Leo YAML completo
   
   b) Actualizo 6 niveles actuales ‚úÖ
      - WBS: 37 ‚Üí 57 estaciones
      - Presupuesto recalculado
      - V.3: Criterio 30% actualizado
      - Matrices: Trazabilidad agregada
   
   c) üÜï RECALCULO LAYOUT:
      - Ejecuto: recalcular_layout_desde_DT.ps1
      - Leo layout.md
      - Encuentro 37 filas tipo "TETRA BS"
      - ELIMINO esas 37 filas
      - CALCULO 57 nuevos PKs:
        * PK_1 = 201+470 (fijo - M√©xico)
        * PK_2 = 201+470 + 10.42 = 211+890
        * PK_3 = 211+890 + 10.42 = 222+310
        * ...
        * PK_57 = 722+250 (fijo - Chiriguan√°)
      - GENERO 57 nuevas filas:
        | UFV23 | 201+470 | TELECOM | TETRA BS | EBT_01 | ...
        | UFV23 | 211+890 | TELECOM | TETRA BS | EBT_02 | ...
        ...
      - INSERTO en layout.md (orden por PK)
      - Versiono: v1.1 ‚Üí v1.2
   
   d) üÜï REGENERO WBS VISUAL:
      - Ejecuto: generar_layout_html_REORGANIZADO.ps1
      - WBS_Layout_Maestro.html ahora tiene 57 TETRA
      - Estad√≠sticas actualizadas:
        Total: 416 equipos (antes 396)
   
   e) COCINO documentos:
      - cocinar.ps1 -Sistema 02
      - SISTEMA_02_...EJECUTIVO.md actualizado
   
   f) SIRVO al cliente:
      - servir.ps1 -Sistema 02
      - Word generado CON:
        * Descripci√≥n: "57 estaciones con 30% solapamiento"
        * ANEXO Layout: Tabla con 57 TETRA + PKs recalculados

3. CLIENTE recibe:
   ‚úÖ Documento coherente
   ‚úÖ Cantidades: 57 estaciones
   ‚úÖ Criterio: 30% solapamiento
   ‚úÖ Layout: 57 ubicaciones PK recalculadas
   ‚úÖ Presupuesto: Recalculado autom√°ticamente
   ‚úÖ TODO sincronizado desde 1 DT
```

---

## ‚ö†Ô∏è **ESTADO ACTUAL DEL LAYOUT:**

### **Problema 1: Layout es copia ciega de layout.md**

```
Tu layout.md original:
  - 396 filas
  - Algunas pueden ser incorrectas
  - Ejemplo: 700 balizas Eurobalise (pero filosof√≠a es VIRTUAL)
  
Mi sistema actual:
  - Copia las 396 filas SIN VALIDAR ‚ùå
  - Las muestra en HTML
  - Las inyecta en documentos
  - NO verifica si concuerdan con DTs
```

---

### **Problema 2: No hay rec√°lculo autom√°tico**

```
Si cambias cantidad TETRA 37 ‚Üí 57:
  
  Actual:
    - WBS se actualiza ‚úÖ
    - Docs se actualizan ‚úÖ
    - Layout.md NO se actualiza ‚ùå
    - Sigues viendo 37 en layout ‚ùå
    - Inconsistencia: Docs dicen "57", Layout muestra "37"
  
  Ideal:
    - WBS se actualiza ‚úÖ
    - Docs se actualizan ‚úÖ
    - Layout se RECALCULA autom√°ticamente ‚úÖ
    - 57 estaciones con PKs redistribuidos ‚úÖ
    - Coherencia total ‚úÖ
```

---

## üéØ **LO QUE PROPONGO IMPLEMENTAR:**

### **Fase 1: Validaci√≥n (1-2 horas)** ‚≠ê PRIORITARIO

**Script:** `validar_coherencia_layout_DTs.ps1`

**Hace:**
1. Lee DTs ejecutadas
2. Extrae cantidades esperadas por tipo de equipo
3. Compara con layout.md actual
4. Genera reporte de inconsistencias
5. Propone correcciones

**Resultado:**
```
REPORTE DE VALIDACI√ìN:

‚ùå Balizas Eurobalise:
   Esperado: 0 (DT-CTC-001: filosof√≠a virtual)
   Real: 700 (layout.md tiene 700 filas)
   Acci√≥n: ELIMINAR 700 filas de balizas

‚úÖ TETRA BS:
   Esperado: 37 (DT-TETRA-001)
   Real: 37 (layout.md tiene 37 filas)
   Estado: OK

‚ùå ATP Embarcado:
   Esperado: 8 (DT-TETRA-001)
   Real: 15 (layout.md tiene 15 filas)
   Acci√≥n: ELIMINAR 7 filas de ATP
```

---

### **Fase 2: Limpieza Manual del Layout (30 min)**

**T√∫ decides qu√© equipos S√ç van:**

```
Editar layout.md:
  1. Eliminar ~700 balizas Eurobalise (filosof√≠a virtual)
  2. Ajustar ATP a 8 unidades
  3. Verificar cantidad de cada equipo vs DTs
  4. Regenerar HTML: generar_layout_html_REORGANIZADO.ps1
```

---

### **Fase 3: Automatizaci√≥n de Rec√°lculo (3-4 horas)**

**Script:** `recalcular_layout_desde_DT.ps1`

**Hace:**
1. Lee DT con cambios de cantidad
2. Calcula nuevas ubicaciones PK
3. Actualiza layout.md
4. Regenera WBS visual
5. Versiona layout autom√°ticamente

---

### **Fase 4: Integraci√≥n Completa (2 horas)**

**Modificar:** `servir.ps1` v2.1

**Agregar:**
- Check de coherencia layout antes de servir
- Warning si layout desactualizado
- Regeneraci√≥n autom√°tica de WBS visual

---

## üìä **ARQUITECTURA PROPUESTA (7 NIVELES + Layout)**

```
DT-TETRA-030 (Solapamiento 30%)
                ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Cursor parsea YAML                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚Üì                        ‚Üì              ‚Üì             ‚Üì
[NIVEL 1-6]            [NIVEL 7]      [NIVEL 8]    [VALIDACI√ìN]
 WBS, Docs,            LAYOUT          WBS Visual   Coherencia
 Maestros,             .md             .html        Check
 √çndices
    ‚Üì                        ‚Üì              ‚Üì             ‚Üì
Cantidades            Ubicaciones     Interfaz      Reporte
actualizadas          recalculadas    "pintada"     inconsist.
    ‚Üì                        ‚Üì              ‚Üì             ‚Üì
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
            cocinar.ps1 (Consolida)
                    ‚Üì
            servir.ps1 (Exporta + Layout)
                    ‚Üì
                Word/HTML
          (Todo coherente ‚úÖ)
```

---

## üîß **¬øQU√â QUIERES QUE HAGA AHORA?**

### **Opci√≥n A: Crear script de validaci√≥n** ‚≠ê RECOMENDADO

```powershell
# Creo: validar_coherencia_layout_DTs.ps1
# T√∫ ejecutas y ves qu√© equipos est√°n mal
# Limpiamos layout.md juntos
```

**Tiempo:** 30 minutos  
**Beneficio:** Sabemos exactamente qu√© corregir

---

### **Opci√≥n B: Crear script de rec√°lculo**

```powershell
# Creo: recalcular_layout_desde_DT.ps1
# Pero primero necesitas layout.md limpio (sin inconsistencias)
```

**Tiempo:** 2-3 horas  
**Requisito:** Layout validado primero

---

### **Opci√≥n C: Limpieza manual guiada**

Te doy un checklist de qu√© equipos eliminar/mantener seg√∫n las DTs ya ejecutadas, t√∫ limpias manualmente.

**Tiempo:** 1 hora (tu trabajo)  
**Beneficio:** Layout correcto inmediatamente

---

## üéØ **MI RECOMENDACI√ìN:**

**PASO 1:** Crear script de validaci√≥n (YO lo hago en 30 min)  
**PASO 2:** Ejecutas y ves reporte de inconsistencias  
**PASO 3:** Limpias layout.md seg√∫n reporte  
**PASO 4:** Regeneras HTML con datos limpios  
**PASO 5:** (Futuro) Implemento rec√°lculo autom√°tico  

---

**¬øProcedo con Opci√≥n A (script de validaci√≥n)?** 

Esto te dir√° **exactamente**:
- Qu√© equipos sobran en el layout
- Qu√© equipos faltan
- Qu√© cantidades est√°n mal
- Qu√© PKs podr√≠an estar incorrectos

ü§î **¬øCreamos el script de validaci√≥n?**

