# REGLAS DE CURSOR PARA SISTEMA WBS INTERACTIVO
# Proyecto: APP La Dorada-ChiriguanÃ¡
# VersiÃ³n: 2.1 | Fecha: 15 de Octubre de 2025
# NUEVO: EjecuciÃ³n Modular de DTs (subsistema por subsistema)

## ğŸ¯ CONTEXTO DEL PROYECTO

Este es un proyecto de ingenierÃ­a EPC (Engineering, Procurement, Construction) para una concesiÃ³n ferroviaria.
El sistema WBS Interactivo permite a especialistas proponer cambios tÃ©cnicos que se documentan como Decisiones TÃ©cnicas (DT)
y se ejecutan automÃ¡ticamente mediante Cursor siguiendo instrucciones YAML embebidas.

**IMPORTANTE:** Las DTs deben propagar cambios en **6 NIVELES** de documentaciÃ³n para mantener coherencia tÃ©cnica completa.

---

## ğŸ”„ FLUJO DE PROPAGACIÃ“N (6 NIVELES)

### **NIVEL 1: IX. WBS Y PLANIFICACIÃ“N** âœ… OBLIGATORIO
```
â”œâ”€ WBS_Presupuestal_v2.0.md (cantidades, VU, totales)
â”œâ”€ datos_wbs_TODOS_items.json (datos completos)
â”œâ”€ wbs_metadata_enriquecida.json (metadata tÃ©cnica)
â””â”€ Interfaces HTML (visualizaciÃ³n)
```

### **NIVEL 2: V. INGENIERÃA DE DETALLE** âš ï¸ CONDICIONAL
```
â””â”€ V.X_Sistema_Detalle_vX.md (secciÃ³n tÃ©cnica especÃ­fica)
    Ejemplo: DT-CTC-002 â†’ V.2 CTC Â§3.2 "Arquitectura"
    
    Script automÃ¡tico: scripts/actualizar_documentos_detalle.ps1
    - Busca archivos V.X mencionados en DTs
    - Versiona automÃ¡ticamente (v5.0 â†’ v5.1)
    - Agrega historial de actualizaciones con ID de DT
    - Trazabilidad completa DT â†’ V.X
```

### **NIVEL 3: III. INGENIERÃA CONCEPTUAL** âš ï¸ SI APLICA
```
â””â”€ Documentos Integrados (criterios/cantidades)
    Ejemplo: 26_Sistema_CTC_Integrado.md
```

### **NIVEL 4: VIII. DOCUMENTOS MAESTROS** âœ… OBLIGATORIO
```
â”œâ”€ CRITERIOS_TECNICOS_MAESTRO_v1.0.md (agrega criterio)
â”œâ”€ MATRIZ_TRAZABILIDAD_TECNICA_v1.0.md (enlaza DT â†’ Docs)
â”œâ”€ MATRIZ_DEPENDENCIAS_DOCUMENTALES_v1.0.md (agrega fila)
â””â”€ MATRIZ_RIESGOS_PMO_AMPLIADA_v1.0.md (si aplica riesgo)

Script automÃ¡tico: scripts/actualizar_documentos_maestros.ps1
- Extrae metadata de DTs (Sistema, Item WBS, Tipo cambio)
- Inserta filas en MATRIZ_DEPENDENCIAS_DOCUMENTALES
- Agrega entradas a MATRIZ_TRAZABILIDAD_TECNICA
- Verifica duplicados antes de insertar
- 18 DTs ya registradas en matrices
```

### **NIVEL 5: X. ENTREGABLES CONSOLIDADOS** âš ï¸ SI EXISTE
```
â””â”€ SISTEMA_XX_Master.md (actualiza si ya consolidado)
```

### **NIVEL 6: ÃNDICES** âœ… OBLIGATORIO
```
â””â”€ Indice_Maestro_Consolidado_v1.0.md (referencias cruzadas)
```

**NOTA:** Niveles âœ… OBLIGATORIOS siempre se actualizan. Niveles âš ï¸ CONDICIONALES solo si aplica segÃºn MATRIZ_DEPENDENCIAS.

---

## ğŸ“‹ EJECUCIÃ“N DE DECISIONES TÃ‰CNICAS (DT)

### DETECCIÃ“N AUTOMÃTICA

Cuando el usuario abre o menciona un archivo `DT-*.md` ubicado en `II. Apendices Tecnicos/Decisiones_Tecnicas/`:

1. **Reconocer como DecisiÃ³n TÃ©cnica**
   - Archivos con patrÃ³n: `DT-[SISTEMA]-[NUMERO]-[FECHA].md`
   - Ejemplos: `DT-FIBRA-042-2025-10-07.md`, `DT-TETRA-015-2025-10-08.md`

2. **Buscar secciÃ³n de instrucciones**
   - SecciÃ³n: `## 10. INSTRUCCIONES PARA CURSOR âš™ï¸`
   - Contiene bloque YAML entre ` ```yaml ` y ` ``` `

3. **Ofrecer ejecuciÃ³n**
   - Preguntar al usuario: "He detectado una DecisiÃ³n TÃ©cnica. Â¿Quieres que la ejecute?"
   - Si usuario dice "SÃ­", "Ejecuta", "Procede" o similar â†’ Iniciar ejecuciÃ³n

---

### PROCESO DE EJECUCIÃ“N

#### **PASO 1: LEER Y PARSEAR YAML**

```markdown
1. Extraer el bloque YAML de la secciÃ³n 10
2. Parsear estructura completa
3. Identificar:
   - dt_metadata (metadatos)
   - archivos_actualizar (lista de archivos y cambios)
   - items_dependientes (si aplica)
   - validaciones (checks pre-ejecuciÃ³n)
   - manejo_errores (estrategias)
```

#### **PASO 2: VALIDACIONES PRE-EJECUCIÃ“N**

SegÃºn el campo `validaciones` en YAML:

```yaml
validaciones:
  - verificar_archivos_existen: true
  - backup_antes_modificar: true
  - validar_formato_numeros: true
  - confirmar_con_usuario: true
```

**Ejecutar validaciones:**
- âœ… `verificar_archivos_existen`: Confirmar que todos los archivos en `archivos_actualizar` existen
- âœ… `backup_antes_modificar`: Crear backup mental de contenido original (para poder revertir)
- âœ… `validar_formato_numeros`: Verificar que nÃºmeros son parseables
- âœ… `confirmar_con_usuario`: Mostrar resumen y pedir confirmaciÃ³n

#### **PASO 3: MOSTRAR RESUMEN Y CONFIRMAR**

Mostrar al usuario:

```
ğŸ“‹ DECISIÃ“N TÃ‰CNICA: [DT-ID]
Ãtem WBS: [codigo]
Tipo de cambio: [tipo]

Archivos a actualizar ([N]):
âœ“ [archivo1] â†’ [acciÃ³n]
âœ“ [archivo2] â†’ [acciÃ³n]
âœ“ ...

Ãtems dependientes a recalcular ([N]):
- [item1]
- [item2]

Validaciones:
âœ“ Todos los archivos existen
âœ“ Backup creado
âœ“ Formato de nÃºmeros validado

Â¿Ejecutar cambios? (SÃ­/No)
```

Si usuario dice "SÃ­" â†’ Continuar al Paso 4
Si usuario dice "No" â†’ Cancelar y reportar

#### **PASO 4: EJECUTAR CAMBIOS**

Para cada elemento en `archivos_actualizar`:

```yaml
- file: "ruta/archivo.md"
  accion: "actualizar_y_versionar"
  seccion: "Item 1.1.3"
  cambios:
    - campo: "cantidad"
      buscar: "2068"
      reemplazar: "1697"
```

**Proceso por archivo:**

1. **Abrir archivo** (usar herramienta `read_file`)

2. **Buscar secciÃ³n** especificada en `seccion`
   - Si no se encuentra â†’ Seguir estrategia en `manejo_errores.seccion_no_encontrada`

3. **Aplicar cambios** segÃºn array `cambios`:
   - Para cada cambio:
     - Buscar valor en `buscar`
     - Reemplazar con valor en `reemplazar`
     - Si `validar_contexto: true` â†’ Verificar que sea el contexto correcto antes de reemplazar

4. **Versionamiento** (si aplica):
   ```yaml
   versionamiento:
     version_actual: "v3.0"
     version_nueva: "v3.1"
     razon: "DT-FIBRA-042 - cantidad"
     agregar_nota: "Origen: DT-FIBRA-042 | Fecha: 2025-10-07"
   ```
   - Actualizar versiÃ³n en header del archivo
   - Agregar nota de origen al final o en secciÃ³n de cambios

5. **Guardar archivo** (usar herramienta `search_replace` o `write`)

6. **Notificar progreso**:
   ```
   âœ“ [archivo] actualizado ([N] cambios aplicados)
   ```

#### **PASO 5: RECALCULAR ÃTEMS DEPENDIENTES**

Si `items_dependientes.recalcular: true`:

```yaml
items_dependientes:
  recalcular: true
  items:
    - "1.1.5"
    - "1.1.10"
  formula_base: "proporcional_a_item_principal"
```

**Para cada Ã­tem dependiente:**
1. Identificar en WBS
2. Aplicar fÃ³rmula segÃºn `formula_base`
   - `proporcional_a_item_principal`: Ajustar proporcionalmente al cambio del Ã­tem principal
   - `fixed_percentage`: Usar porcentaje fijo
3. Actualizar valores en archivo WBS
4. Reportar cambios

#### **PASO 6: ACTUALIZAR MATRIZ DE DEPENDENCIAS**

Si hay entrada para actualizar `MATRIZ_DEPENDENCIAS_DOCUMENTALES`:

```yaml
- file: "VIII.../MATRIZ_DEPENDENCIAS_DOCUMENTALES_v1.0.md"
  accion: "agregar_fila"
  nueva_fila:
    sistema: "fibra"
    decision_tecnica: "DT-FIBRA-042"
    archivos_afectados: "WBS_Presupuestal, 2 archivos"
    tipo_impacto: "Cantidades"
```

**Proceso:**
1. Abrir archivo de matriz
2. Buscar tabla principal
3. Agregar nueva fila con formato Markdown:
   ```markdown
   | fibra | DT-FIBRA-042 | WBS_Presupuestal, 2 archivos | Cantidades |
   ```
4. Guardar archivo

#### **PASO 7: ACTUALIZAR DT CON LOG DE EJECUCIÃ“N**

En el archivo DT original:

1. **Marcar checkbox de "Ejecutado"** en secciÃ³n 11:
   ```markdown
   - [x] ğŸ”§ Ejecutado por Cursor: [fecha-hora]
   ```

2. **Completar secciÃ³n 12 "LOG DE EJECUCIÃ“N"**:
   ```markdown
   ## 12. LOG DE EJECUCIÃ“N

   ```
   Fecha ejecuciÃ³n: 2025-10-07 15:45:30
   Usuario Cursor: [tu nombre]
   Archivos modificados: 3 (WBS_Presupuestal_v3.1.md, V.3_Comunicacion.md, MATRIZ_DEPENDENCIAS.md)
   Ãtems recalculados: 2 (1.1.5, 1.1.10)
   Errores encontrados: 0
   Tiempo ejecuciÃ³n: 12 segundos
   ```
   ```

#### **PASO 8: REPORTE FINAL**

Mostrar al usuario:

```
âœ… DT-[ID] EJECUTADA EXITOSAMENTE

ğŸ“Š RESUMEN:
- Archivos actualizados: [N]
  âœ“ WBS_Presupuestal v3.0 â†’ v3.1 (2 cambios)
  âœ“ V.3_Sistemas_Comunicacion_Detalle.md (1 cambio)
  âœ“ MATRIZ_DEPENDENCIAS_DOCUMENTALES (nueva fila)

- Ãtems dependientes recalculados: [N]
  âœ“ 1.1.5 - Uniones rÃ¡pidas
  âœ“ 1.1.10 - Insumos fusionado

- Matrices actualizadas:
  âœ“ MATRIZ_DEPENDENCIAS_DOCUMENTALES

- Log completado en: DT-[ID].md (SecciÃ³n 12)

ğŸ‰ Todos los cambios aplicados correctamente.
```

---

### MANEJO DE ERRORES

SegÃºn el campo `manejo_errores` en YAML:

```yaml
manejo_errores:
  - archivo_no_existe: "reportar_y_continuar"
  - seccion_no_encontrada: "pedir_confirmacion_manual"
  - validacion_falla: "detener_y_reportar"
  - backup_falla: "detener_ejecucion"
```

**Estrategias:**

1. **`reportar_y_continuar`**
   - Reportar error al usuario
   - Continuar con siguiente archivo
   - Ejemplo: "âš ï¸ Archivo X no encontrado. Continuando con siguiente..."

2. **`pedir_confirmacion_manual`**
   - Reportar situaciÃ³n al usuario
   - Pedir confirmaciÃ³n antes de continuar
   - Ejemplo: "âš ï¸ SecciÃ³n Y no encontrada en archivo X. Â¿Buscar manualmente? (SÃ­/No)"

3. **`detener_y_reportar`**
   - Detener ejecuciÃ³n inmediatamente
   - Reportar error detallado
   - No aplicar mÃ¡s cambios
   - Ejemplo: "âŒ ValidaciÃ³n fallÃ³: [razÃ³n]. EjecuciÃ³n detenida. No se aplicaron cambios."

4. **`detener_ejecucion`**
   - Detener sin preguntar
   - Revertir cambios si es posible
   - Reportar estado

---

## ğŸ” COMANDOS ESPECIALES

### Cuando usuario escribe:

- **"Ejecuta DT-[ID]"** o **"Ejecuta esta DT"**
  â†’ Buscar archivo DT con ese ID y ejecutarlo

- **"Simula DT-[ID]"** o **"Modo dry-run"**
  â†’ Hacer toda la lectura y anÃ¡lisis pero NO aplicar cambios
  â†’ Reportar quÃ© se harÃ­a

- **"Valida DT-[ID]"**
  â†’ Solo ejecutar validaciones (Paso 2)
  â†’ Reportar si es ejecutable

- **"Revierte DT-[ID]"**
  â†’ Si hay backup, revertir cambios
  â†’ Marcar DT como "Revertida"

---

## ğŸ”§ EJECUCIÃ“N MODULAR (NUEVO - v2.1)

### **DETECCIÃ“N DE MODO MODULAR**

Cuando detectes un archivo DT con `ejecucion_modular.activado: true` en el YAML:

1. **Identificar subsistemas**
   - Leer campo `subsistemas` en YAML
   - Contar cuÃ¡ntos subsistemas hay
   - Identificar dependencias entre ellos
   - Marcar cuÃ¡les son crÃ­ticos vs opcionales

2. **Preguntar modo de ejecuciÃ³n**
   ```
   ğŸ“‹ DT-[ID] detectada ([N] subsistemas)
   
   Â¿CÃ³mo quieres ejecutar?
   
   1. âš¡ Todo automÃ¡tico (ejecutar todos sin pausas)
   2. ğŸ”§ Subsistema por subsistema (RECOMENDADO)
   3. ğŸ‘ï¸  Solo simular (dry-run)
   4. âŒ Cancelar
   
   Tu elecciÃ³n [1/2/3/4]:
   ```

---

### **MODO 1: EJECUCIÃ“N AUTOMÃTICA**

Si usuario elige opciÃ³n 1:

1. Mostrar resumen de todos los subsistemas
2. Pedir confirmaciÃ³n Ãºnica
3. Ejecutar todos secuencialmente
4. Si falla subsistema crÃ­tico â†’ Detener
5. Si falla subsistema opcional â†’ Continuar
6. Mostrar resumen final

---

### **MODO 2: EJECUCIÃ“N SUBSISTEMA POR SUBSISTEMA (RECOMENDADO)**

Si usuario elige opciÃ³n 2:

#### **Para cada subsistema en orden:**

**PASO 2.1: MOSTRAR INFORMACIÃ“N**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUBSISTEMA [N]/[TOTAL]: [NOMBRE]                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ ID: [id]                                                    â”‚
â”‚ CrÃ­tico: [SÃ/NO]                                           â”‚
â”‚ Dependencias: [lista o "ninguna"]                          â”‚
â”‚                                                              â”‚
â”‚ ARCHIVOS A MODIFICAR ([N]):                                â”‚
â”‚   â€¢ [archivo1]                                             â”‚
â”‚   â€¢ [archivo2]                                             â”‚
â”‚                                                              â”‚
â”‚ SCRIPTS A EJECUTAR ([N]):                                  â”‚
â”‚   â€¢ [script1] - [descripciÃ³n]                              â”‚
â”‚                                                              â”‚
â”‚ VALIDACIONES ([N]):                                        â”‚
â”‚   âœ“ [validaciÃ³n1]                                          â”‚
â”‚   âœ“ [validaciÃ³n2]                                          â”‚
â”‚                                                              â”‚
â”‚ RESULTADO ESPERADO:                                         â”‚
â”‚   [descripciÃ³n del resultado]                              â”‚
â”‚                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Â¿Ejecutar este subsistema? [S/n/i/q]                      â”‚
â”‚   S = SÃ­, ejecutar ahora                                   â”‚
â”‚   n = No, saltar (solo si NO es crÃ­tico)                   â”‚
â”‚   i = MÃ¡s informaciÃ³n                                       â”‚
â”‚   q = Cancelar todo                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**PASO 2.2: PROCESAR RESPUESTA**

- **Si "S" o "s"**: Continuar con ejecuciÃ³n
- **Si "n" o "N"**: 
  - Si subsistema es crÃ­tico â†’ Advertir y volver a preguntar
  - Si subsistema es opcional â†’ Marcar como OMITIDO y continuar con siguiente
- **Si "i" o "I"**: Mostrar detalles adicionales (YAML completo del subsistema)
- **Si "q" o "Q"**: Cancelar toda la DT

**PASO 2.3: EJECUTAR SUBSISTEMA**

1. **Validaciones previas:**
   - Verificar archivos existen
   - Verificar dependencias cumplidas
   - Validar parÃ¡metros

2. **EjecuciÃ³n:**
   - Ejecutar scripts en orden
   - Aplicar cambios a archivos
   - Mostrar progreso en tiempo real

3. **Validaciones posteriores:**
   - Verificar cambios aplicados correctamente
   - Validar resultado esperado
   - **EJECUTAR validaciones_post** (si estÃ¡n definidas):
     - Si validaciÃ³n tiene `script`: Ejecutar script con parÃ¡metros
     - Si validaciÃ³n tiene `obligatoria: true` y falla â†’ Detener y reportar error
     - Si validaciÃ³n tiene `obligatoria: false` y falla â†’ Advertencia y continuar
     - Mostrar `mensaje_exito` o `mensaje_fallo` segÃºn resultado

4. **Reportar resultado:**
   ```
   âœ… SUBSISTEMA [N] COMPLETADO
   
   Tiempo: [X] segundos
   
   Archivos modificados:
     âœ“ [archivo1] - [N] cambios
     âœ“ [archivo2] - Regenerado
   
   Scripts ejecutados:
     âœ“ [script1] - Exitoso
   
   Validaciones:
     âœ“ [validaciÃ³n1] - OK
     âœ“ [validaciÃ³n2] - OK
   
   Validaciones Post-EjecuciÃ³n:
     âœ“ [script_validacion] - âœ… EXITOSO
     âœ“ [verificaciÃ³n_totales] - âœ… OK
   
   Resultado: [descripciÃ³n]
   ```

**PASO 2.4: SI SUBSISTEMA FALLA**

```
âŒ SUBSISTEMA [N] FALLÃ“

Error: [descripciÃ³n del error]

Archivo: [archivo donde fallÃ³]
LÃ­nea: [si aplica]

Â¿QuÃ© quieres hacer?

1. ğŸ”„ Reintentar este subsistema
2. â­ï¸  Continuar sin este subsistema (solo si NO es crÃ­tico)
3. â†©ï¸  Revertir cambios de este subsistema
4. ğŸ›‘ Cancelar toda la DT
5. â„¹ï¸  Ver detalles del error

Tu elecciÃ³n [1/2/3/4/5]:
```

**Procesamiento:**
- **OpciÃ³n 1:** Reintentar mismo subsistema
- **OpciÃ³n 2:** Solo si `critico: false`, marcar FALLIDO y continuar
- **OpciÃ³n 3:** Ejecutar rollback del subsistema
- **OpciÃ³n 4:** Detener, marcar subsistemas completados en log
- **OpciÃ³n 5:** Mostrar stack trace / detalles, luego volver a preguntar

**PASO 2.5: CONTINUAR CON SIGUIENTE SUBSISTEMA**

DespuÃ©s de cada subsistema exitoso, verificar:
- Â¿Hay mÃ¡s subsistemas pendientes?
- Â¿Sus dependencias estÃ¡n cumplidas?
- Mostrar progreso: "Completados: [N]/[TOTAL]"

---

### **MODO 3: SIMULACIÃ“N (DRY-RUN)**

Si usuario elige opciÃ³n 3:

1. Leer todos los subsistemas
2. **NO ejecutar** scripts ni modificar archivos
3. Reportar quÃ© SE HARÃA en cada subsistema
4. Mostrar posibles conflictos o problemas
5. Mostrar resumen final de cambios potenciales

Formato:
```
ğŸ” SIMULACIÃ“N DT-[ID] (Dry-run mode)

SUBSISTEMA 1/[N]: [NOMBRE]
  Archivos que se modificarÃ­an:
    â€¢ [archivo1] â†’ [descripciÃ³n de cambio]
    â€¢ [archivo2] â†’ Regenerado
  
  Scripts que se ejecutarÃ­an:
    â€¢ [script1]
  
  Validaciones que se aplicarÃ­an:
    âœ“ [validaciÃ³n1]

[Repetir para cada subsistema]

âœ“ SimulaciÃ³n completa. No se aplicaron cambios.
```

---

### **PASO FINAL: REPORTE COMPLETO**

Al terminar (exitosamente o con errores), generar reporte:

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  DT-[ID] - REPORTE DE EJECUCIÃ“N MODULAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SUBSISTEMAS EJECUTADOS: [N_exitosos]/[TOTAL]

âœ… EXITOSOS ([N]):
  1. [nombre1] - [tiempo]s
  2. [nombre2] - [tiempo]s

âŒ FALLIDOS ([N]):
  1. [nombre] - Error: [descripciÃ³n breve]

âš ï¸  OMITIDOS ([N]):
  1. [nombre] - (opcional, saltado por usuario)

ARCHIVOS MODIFICADOS TOTAL: [N]
  â€¢ [archivo1]
  â€¢ [archivo2]
  ...

SCRIPTS EJECUTADOS: [N]/[TOTAL]
  âœ“ [script1]
  âœ“ [script2]

TIEMPO TOTAL: [X] minutos [Y] segundos

ESTADO FINAL: 
  [âœ… EJECUCIÃ“N COMPLETA / âš ï¸ PARCIAL / âŒ FALLIDA]
```

**Actualizar log en archivo DT:**
- Completar secciÃ³n "LOG DE EJECUCIÃ“N"
- Detallar cada subsistema ejecutado
- Marcar checkboxes en secciÃ³n "ESTADO DE EJECUCIÃ“N"
- Agregar timestamp de cada subsistema

---

### **REGLAS ESPECIALES PARA EJECUCIÃ“N MODULAR**

1. **Dependencias:**
   - Si subsistema B depende de A, verificar que A estÃ© OK antes de ejecutar B
   - Si A fallÃ³ y B depende de A â†’ Marcar B como "NO EJECUTABLE"

2. **Subsistemas crÃ­ticos vs opcionales:**
   - `critico: true` â†’ No se puede saltar, fallo detiene DT
   - `critico: false` â†’ Puede saltarse o fallar sin detener DT

3. **Rollback:**
   - Si `rollback.posible: true` â†’ Ofrecer revertir cambios
   - Mantener backup mental del estado anterior
   - Ejecutar rollback en orden inverso (Ãºltimo â†’ primero)

4. **Timeout:**
   - Respetar `timeout_segundos` en scripts
   - Si excede timeout â†’ Ofrecer:
     - Esperar mÃ¡s tiempo
     - Cancelar script
     - Continuar sin ese subsistema

5. **Validaciones:**
   - **Pre-ejecuciÃ³n:** Ejecutar ANTES de modificar archivos
     - Si validaciÃ³n falla â†’ No ejecutar subsistema
     - Validaciones opcionales pueden fallar sin detener
   - **Post-ejecuciÃ³n:** Ejecutar DESPUÃ‰S de modificar archivos
     - Campo: `validaciones_post` en YAML
     - Especialmente Ãºtil para WBS (validar cantidades Ã— VU = Total)
     - Si `obligatoria: true` y falla â†’ Ofrecer rollback
     - Ejemplo: `scripts/validar_wbs_cantidades_totales.ps1`

6. **Progreso:**
   - Mostrar siempre: "Subsistema [N]/[TOTAL]"
   - Mostrar tiempo transcurrido
   - Actualizar en tiempo real si es posible

---

### **NUEVOS COMANDOS MODULARES**

- **"Ejecuta DT-[ID] modo modular"**
  â†’ Forzar modo subsistema por subsistema

- **"Ejecuta solo subsistema [nombre/numero] de DT-[ID]"**
  â†’ Ejecutar UN solo subsistema especÃ­fico

- **"Reintenta subsistema [nombre/numero]"**
  â†’ Reintentar subsistema que fallÃ³

- **"Revierte subsistema [nombre/numero]"**
  â†’ Rollback de subsistema especÃ­fico

- **"Estado DT-[ID]"**
  â†’ Mostrar quÃ© subsistemas estÃ¡n OK/FALLO/PENDIENTE

---

## ğŸ“ FORMATO DE ARCHIVOS

### WBS Presupuestal
- Formato: Markdown con tablas
- Versionamiento: vX.Y en header
- Ãtems con formato: `## [codigo] - [descripcion]`

### Documentos TÃ©cnicos
- Formatos: Markdown (.md)
- Secciones numeradas
- Referencias cruzadas con formato: `[doc] (SecciÃ³n X.Y)`

### Matrices
- Tablas Markdown
- Headers fijos
- Nueva fila al final de tabla

---

## âš™ï¸ CONFIGURACIÃ“N DE COMPORTAMIENTO

### Siempre:
- âœ… Pedir confirmaciÃ³n antes de modificar archivos
- âœ… Crear backup mental del contenido original
- âœ… Reportar cada cambio aplicado
- âœ… Actualizar log en DT
- âœ… Ser explÃ­cito sobre quÃ© se estÃ¡ haciendo

### Nunca:
- âŒ Modificar archivos sin confirmaciÃ³n
- âŒ Omitir validaciones
- âŒ Ejecutar sin parsear YAML completo
- âŒ Aplicar cambios si validaciÃ³n falla
- âŒ Modificar archivos fuera de los especificados en YAML

---

## ğŸ¯ PRIORIDADES

1. **SEGURIDAD**: No aplicar cambios sin confirmaciÃ³n
2. **TRAZABILIDAD**: Documentar todo en log
3. **INTEGRIDAD**: Validar antes de ejecutar
4. **CLARIDAD**: Reportar quÃ© se estÃ¡ haciendo
5. **REVERSIBILIDAD**: Mantener forma de revertir

---

## ğŸ“š EJEMPLOS

### Ejemplo 1: Usuario abre DT-FIBRA-042-2025-10-07.md

```
CURSOR:
ğŸ“‹ He detectado una DecisiÃ³n TÃ©cnica: DT-FIBRA-042

Ãtem WBS: 1.1.3 - Cajas de empalme
Tipo de cambio: Ajuste de cantidad
Archivos a actualizar: 3
Ãtems dependientes: 2

Â¿Quieres que ejecute esta DT? (SÃ­/No)

USUARIO:
SÃ­

CURSOR:
âœ… Validaciones completadas
- Todos los archivos existen
- Backup creado
- Formato validado

Iniciando ejecuciÃ³n...

âœ“ WBS_Presupuestal_v3.0.md â†’ v3.1 (2 cambios)
âœ“ V.3_Comunicacion.md (1 cambio)
âœ“ MATRIZ_DEPENDENCIAS.md (nueva fila)
âœ“ Recalculado: 1.1.5, 1.1.10

âœ… DT-FIBRA-042 ejecutada exitosamente
Log completado en DT-FIBRA-042-2025-10-07.md
```

### Ejemplo 2: Usuario pide simulaciÃ³n

```
USUARIO:
Simula DT-TETRA-015

CURSOR:
ğŸ” SIMULACIÃ“N DT-TETRA-015 (Dry-run mode)

Archivos que se modificarÃ­an (2):
- WBS_Presupuestal_v4.0.md
  â†’ Cambio: cantidad "37" â†’ "42" en item 2.1.100
  â†’ VersiÃ³n: v4.0 â†’ v4.1

- III/29_Sistema_TETRA.md
  â†’ Cambio: "37 estaciones" â†’ "42 estaciones" en SecciÃ³n 3.1

Ãtems que se recalcularÃ­an (1):
- 2.1.101: Antenas (proporcional)

Matrices que se actualizarÃ­an:
- MATRIZ_DEPENDENCIAS: Nueva fila

âœ“ SimulaciÃ³n completa. No se aplicaron cambios.
```

---

**Ãšltima actualizaciÃ³n:** 7 de Octubre de 2025  
**VersiÃ³n:** 1.0  
**Compatibilidad:** WBS Interactiva v3.0+  

