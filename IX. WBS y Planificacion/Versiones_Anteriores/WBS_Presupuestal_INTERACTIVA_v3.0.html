<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WBS Presupuestal Interactiva v3.0 - APP La Dorada-Chiriguan√°</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --bg-light: #ecf0f1;
            --text-dark: #2c3e50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 20px;
            background: var(--success-color);
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
        }

        .main-content {
            padding: 30px;
        }

        .item-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .item-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: var(--secondary-color);
        }

        .item-card.modificable {
            border-left: 5px solid var(--success-color);
        }

        .item-header {
            display: grid;
            grid-template-columns: 100px 2fr 1fr 1fr 1.5fr;
            gap: 15px;
            margin-bottom: 15px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .item-data {
            display: grid;
            grid-template-columns: 100px 2fr 1fr 1fr 1.5fr;
            gap: 15px;
            align-items: start;
        }

        .criterio-box {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid var(--success-color);
            margin-top: 10px;
        }

        .riesgos-box {
            background: #fff3e0;
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid var(--warning-color);
            margin-top: 10px;
        }

        .riesgo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: white;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .riesgo-badge {
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .riesgo-alto { background: #ffebee; color: #c62828; }
        .riesgo-medio { background: #fff3e0; color: #ef6c00; }
        .riesgo-bajo { background: #e8f5e9; color: #2e7d32; }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn-primary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: var(--danger-color);
        }

        .alternatives-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .alternative-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .alternative-card:hover {
            border-color: var(--secondary-color);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .alternative-card.recommended {
            border-color: var(--success-color);
            border-width: 3px;
            background: #f1f8f4;
        }

        .score {
            font-size: 2em;
            font-weight: bold;
            color: var(--success-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: var(--primary-color);
            color: white;
            font-weight: bold;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .modificable-badge {
            display: inline-block;
            padding: 5px 15px;
            background: var(--success-color);
            color: white;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .no-modificable-badge {
            display: inline-block;
            padding: 5px 15px;
            background: #95a5a6;
            color: white;
            border-radius: 15px;
            font-size: 0.85em;
        }

        .observacion-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1em;
            min-height: 100px;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        .impact-summary {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid var(--secondary-color);
            margin: 20px 0;
        }

        .stat-box {
            display: inline-block;
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä WBS Presupuestal Interactiva v3.0</h1>
            <p>APP La Dorada-Chiriguan√° - Con Criterios T√©cnicos y Gesti√≥n de Riesgos</p>
            <span class="status-badge">‚úÖ Gesti√≥n de Cambios Activa</span>
        </header>

        <div class="main-content">
            <h2>CAP√çTULO 2.3: FIBRA √ìPTICA</h2>
            
            <!-- √çTEM 2.3.103 - CAJAS DE EMPALME (EJEMPLO COMPLETO) -->
            <div class="item-card modificable" id="item-2-3-103">
                <div class="item-header">
                    <div>√çTEM</div>
                    <div>DESCRIPCI√ìN</div>
                    <div>CANTIDAD</div>
                    <div>VU (COP)</div>
                    <div>TOTAL (COP)</div>
                </div>

                <div class="item-data">
                    <div><strong>2.3.103</strong></div>
                    <div>
                        Cajas empalme 80x80 IP68
                        <span class="modificable-badge">‚úÖ Modificable</span>
                    </div>
                    <div id="cantidad-cajas"><strong>2,068 unidades</strong></div>
                    <div>$1,350,000</div>
                    <div id="total-cajas"><strong>$2,791,800,000</strong></div>
                </div>

                <!-- CRITERIO T√âCNICO -->
                <div class="criterio-box">
                    <h4>üéØ Criterio T√©cnico:</h4>
                    <p><strong>Norma UIT-T G.652.D:</strong> Espaciamiento m√°ximo 500m</p>
                    <p><strong>Aplicado:</strong> 300m (m√°s conservador)</p>
                    <p><strong>C√°lculo:</strong> 594,000m √∑ 300m = 1,980 cajas base + 88 nodos cr√≠ticos = 2,068 total</p>
                    <p><strong>Justificaci√≥n:</strong></p>
                    <ul>
                        <li>‚úÖ Facilita localizaci√≥n de fallas</li>
                        <li>‚úÖ Acceso sin equipo especializado</li>
                        <li>‚úÖ Redundancia en nodos cr√≠ticos</li>
                    </ul>
                    <p><strong>Referencia:</strong> <code>III/28_Sistema_FibraOptica_Integrado.md (Secci√≥n 2.2)</code></p>
                </div>

                <!-- RIESGOS ASOCIADOS (Auto-cargados desde matriz) -->
                <div class="riesgos-box" id="riesgos-2-3-103">
                    <h4>‚ö†Ô∏è Riesgos Asociados: <span id="count-riesgos-cajas">3</span></h4>
                    
                    <div class="riesgo-item">
                        <div>
                            <strong>R-FIBRA-003:</strong> Espaciamiento muy corto aumenta CAPEX
                        </div>
                        <div>
                            <span class="riesgo-badge riesgo-alto">Alta Prob</span>
                            <span class="riesgo-badge riesgo-alto">Alto Impacto</span>
                        </div>
                    </div>

                    <div class="riesgo-item">
                        <div>
                            <strong>R-FIBRA-006:</strong> Si se reduce espaciamiento, aumenta tiempo localizaci√≥n fallas
                        </div>
                        <div>
                            <span class="riesgo-badge riesgo-bajo">Baja Prob</span>
                            <span class="riesgo-badge riesgo-medio">Medio Impacto</span>
                        </div>
                    </div>

                    <div class="riesgo-item">
                        <div>
                            <strong>R-FIBRA-008:</strong> Acceso a cajas cada 300m dificulta mantenimiento vehicular
                        </div>
                        <div>
                            <span class="riesgo-badge riesgo-medio">Media Prob</span>
                            <span class="riesgo-badge riesgo-medio">Medio Impacto</span>
                        </div>
                    </div>

                    <button class="btn btn-primary" style="margin-top: 10px;" onclick="recargarRiesgos('2-3-103')">
                        üîÑ Actualizar Riesgos desde Matriz
                    </button>
                </div>

                <!-- BOT√ìN DE PROPONER CAMBIO -->
                <div style="margin-top: 20px; text-align: right;">
                    <button class="btn btn-primary" onclick="abrirModalPropuesta('2.3.103')">
                        üìù Proponer Cambio T√©cnico
                    </button>
                </div>
            </div>

            <!-- M√ÅS √çTEMS... -->
            <div class="item-card">
                <div class="item-header">
                    <div>√çTEM</div>
                    <div>DESCRIPCI√ìN</div>
                    <div>CANTIDAD</div>
                    <div>VU (COP)</div>
                    <div>TOTAL (COP)</div>
                </div>

                <div class="item-data">
                    <div><strong>2.3.100</strong></div>
                    <div>
                        Cable fibra √≥ptica 48 fibras
                        <span class="no-modificable-badge">‚ùå No modificable (Contractual)</span>
                    </div>
                    <div>594 km</div>
                    <div>$9,811,013</div>
                    <div>$5,827,741,722</div>
                </div>

                <div class="criterio-box">
                    <h4>üéØ Criterio T√©cnico:</h4>
                    <p><strong>Base contractual:</strong> Longitud corredor 594 km (AT1)</p>
                    <p><strong>No modificable:</strong> Obligaci√≥n contractual</p>
                </div>
            </div>

        </div>
    </div>

    <!-- MODAL: PROPUESTA DE CAMBIO -->
    <div id="modalPropuesta" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal()">&times;</span>
            
            <h2>üìù Propuesta de Cambio T√©cnico - √çtem <span id="modal-item-id"></span></h2>
            
            <div class="item-card" style="background: #f8f9fa;">
                <h3>üìä Estado Actual</h3>
                <table>
                    <tr>
                        <td><strong>Componente:</strong></td>
                        <td id="modal-componente"></td>
                    </tr>
                    <tr>
                        <td><strong>Cantidad actual:</strong></td>
                        <td id="modal-cantidad-actual"></td>
                    </tr>
                    <tr>
                        <td><strong>Costo actual:</strong></td>
                        <td id="modal-costo-actual"></td>
                    </tr>
                    <tr>
                        <td><strong>Criterio actual:</strong></td>
                        <td id="modal-criterio-actual"></td>
                    </tr>
                </table>
            </div>

            <div class="observacion-form">
                <h3>üí¨ Tu Observaci√≥n</h3>
                <p style="color: #666; margin-bottom: 10px;">Describe qu√© cambio propones y por qu√©:</p>
                <textarea id="observacion-texto" placeholder="Ejemplo: Sugiero cambiar espaciamiento a 500m (en vez de 300m) para facilitar acceso vehicular y reducir costos de instalaci√≥n. Mantener cumplimiento UIT-T."></textarea>
                
                <h4 style="margin-top: 20px;">üìê Par√°metro a Modificar:</h4>
                <label>
                    <input type="radio" name="parametro" value="espaciamiento" checked> 
                    Espaciamiento de cajas
                </label>
                <br>
                <label>
                    Nuevo valor: <input type="number" id="nuevo-espaciamiento" value="500" min="300" max="2000" step="100"> metros
                </label>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <button class="btn btn-success" onclick="generarAlternativas()">
                    üî¨ Generar An√°lisis de Alternativas
                </button>
            </div>

            <!-- AN√ÅLISIS COMPLETO (SE MUESTRA DESPU√âS DE GENERAR) -->
            <div id="alternativas-container" style="display: none;">
                <h2 style="margin-top: 30px;">üî¨ AN√ÅLISIS T√âCNICO COMPLETO - DT-FIBRA-001</h2>
                
                <!-- RESUMEN EJECUTIVO -->
                <div class="impact-summary">
                    <h3>üí∞ Resumen Ejecutivo</h3>
                    <div class="stat-box">
                        <div class="stat-label">Ahorro Potencial</div>
                        <div class="stat-value" id="ahorro-total">$0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Reducci√≥n CAPEX</div>
                        <div class="stat-value" id="reduccion-porcentaje">0%</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Archivos Afectados</div>
                        <div class="stat-value" id="archivos-afectados">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Riesgos Nuevos</div>
                        <div class="stat-value" id="riesgos-nuevos">0</div>
                    </div>
                </div>

                <!-- AN√ÅLISIS DE CRITERIOS T√âCNICOS -->
                <div class="criterio-box" style="margin: 20px 0;">
                    <h3>üéØ An√°lisis de Criterios T√©cnicos</h3>
                    <table>
                        <tr>
                            <th>Criterio</th>
                            <th>Valor Actual</th>
                            <th>Valor Propuesto</th>
                            <th>Cumplimiento</th>
                            <th>Observaciones</th>
                        </tr>
                        <tr id="criterio-norma">
                            <td><strong>Norma UIT-T G.652.D</strong></td>
                            <td>300m (m√°s conservador que l√≠mite 500m)</td>
                            <td id="criterio-propuesto">-</td>
                            <td id="criterio-cumplimiento">‚úÖ Cumple</td>
                            <td id="criterio-obs">Dentro de norma</td>
                        </tr>
                        <tr>
                            <td><strong>Acceso vehicular</strong></td>
                            <td>‚ùå Dif√≠cil (cada 300m)</td>
                            <td id="acceso-propuesto">-</td>
                            <td id="acceso-cumplimiento">-</td>
                            <td id="acceso-obs">-</td>
                        </tr>
                        <tr>
                            <td><strong>Localizaci√≥n de fallas</strong></td>
                            <td>‚úÖ R√°pida (cada 300m)</td>
                            <td id="fallas-propuesto">-</td>
                            <td id="fallas-cumplimiento">-</td>
                            <td id="fallas-obs">-</td>
                        </tr>
                        <tr>
                            <td><strong>Costo-efectividad</strong></td>
                            <td>‚ùå Alto CAPEX</td>
                            <td id="costo-propuesto">-</td>
                            <td id="costo-cumplimiento">-</td>
                            <td id="costo-obs">-</td>
                        </tr>
                    </table>
                </div>

                <!-- AN√ÅLISIS DE IMPACTO EN OTROS √çTEMS WBS -->
                <div class="impact-summary" style="background: #fff3e0; border-left-color: var(--warning-color);">
                    <h3>üîó Impacto en √çtems Relacionados</h3>
                    <table>
                        <tr>
                            <th>√çtem WBS</th>
                            <th>Descripci√≥n</th>
                            <th>Cant. Actual</th>
                            <th>Cant. Nueva</th>
                            <th>Œî Costo</th>
                        </tr>
                        <tbody id="impacto-otros-items">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                </div>

                <!-- AN√ÅLISIS DE RIESGOS DETALLADO -->
                <div class="riesgos-box">
                    <h3>‚ö†Ô∏è An√°lisis de Riesgos por Alternativa</h3>
                    <div id="analisis-riesgos-detallado">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>

                <!-- ARCHIVOS QUE SE ACTUALIZAR√ÅN -->
                <div style="background: #e8f5e9; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 5px solid var(--success-color);">
                    <h3>üìÅ Archivos que se Actualizar√°n (Auto-consultado MATRIZ_DEPENDENCIAS)</h3>
                    <table>
                        <tr>
                            <th>Archivo</th>
                            <th>Ubicaci√≥n</th>
                            <th>Secci√≥n</th>
                            <th>Tipo Cambio</th>
                            <th>Versi√≥n</th>
                        </tr>
                        <tbody id="archivos-actualizar">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                </div>

                <!-- COMPARATIVA DE ALTERNATIVAS -->
                <h3 style="margin: 30px 0 15px 0;">üìä Comparativa de Alternativas</h3>
                <div class="alternatives-grid" id="alternatives-grid">
                    <!-- Se llena din√°micamente con JavaScript -->
                </div>

                <!-- RECOMENDACI√ìN DEL SISTEMA -->
                <div id="recomendacion-sistema" style="background: #e8f5e9; padding: 20px; border-radius: 10px; margin: 20px 0; border: 3px solid var(--success-color);">
                    <!-- Se llena din√°micamente -->
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-danger" onclick="cerrarModal()">‚ùå Cancelar</button>
                    <button class="btn btn-primary" onclick="enviarAprobacion()">üì® Enviar para Aprobaci√≥n PMO</button>
                    <button class="btn btn-success" onclick="ejecutarCambio()">‚úÖ Aprobar y Ejecutar Cambio</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DATOS DEL PROYECTO (Cargados desde archivos)
        const datosProyecto = {
            longitudCorredor: 594, // km
            precioUnitarioCaja: 1350000, // COP
            riesgosMatriz: null // Se carga desde archivo JSON
        };

        // DATOS ACTUALES √çTEM 2.3.103
        const item2_3_103 = {
            id: '2.3.103',
            descripcion: 'Cajas empalme 80x80 IP68',
            cantidadActual: 2068,
            espaciamientoActual: 300, // metros
            costoActual: 2791800000,
            modificable: true,
            criterio: 'UIT-T: 300m est√°ndar + 88 nodos cr√≠ticos',
            riesgos: ['R-FIBRA-003', 'R-FIBRA-006', 'R-FIBRA-008'],
            archivosAfectados: [
                { archivo: 'V.3_Sistemas_Comunicacion_Detalle.md', seccion: 'Tabla 5.3' },
                { archivo: 'WBS_Presupuestal_v3.0.md', seccion: 'Item 2.3.103' },
                { archivo: 'IV/37_Memorias_Diseno_Basico.md', seccion: 'Secci√≥n 4.2.3' },
                { archivo: 'III/28_Sistema_FibraOptica_Integrado.md', seccion: 'Secci√≥n 2.2' },
                { archivo: 'X/SISTEMA_02_Telecomunicaciones_Master.md', seccion: 'Secci√≥n 5.2.3' }
            ]
        };

        function abrirModalPropuesta(itemId) {
            document.getElementById('modalPropuesta').style.display = 'block';
            document.getElementById('modal-item-id').textContent = itemId;
            document.getElementById('modal-componente').textContent = item2_3_103.descripcion;
            document.getElementById('modal-cantidad-actual').textContent = `${item2_3_103.cantidadActual} unidades (cada ${item2_3_103.espaciamientoActual}m)`;
            document.getElementById('modal-costo-actual').textContent = `$${item2_3_103.costoActual.toLocaleString('es-CO')} COP`;
            document.getElementById('modal-criterio-actual').textContent = item2_3_103.criterio;
        }

        function cerrarModal() {
            document.getElementById('modalPropuesta').style.display = 'none';
            document.getElementById('alternativas-container').style.display = 'none';
        }

        function generarAlternativas() {
            const nuevoEspaciamiento = parseInt(document.getElementById('nuevo-espaciamiento').value);
            const observacion = document.getElementById('observacion-texto').value;

            if (!observacion) {
                alert('Por favor escribe una observaci√≥n explicando por qu√© propones este cambio');
                return;
            }

            // 1. CALCULAR ALTERNATIVAS
            const alternativas = [
                calcularAlternativa(300, 'Mantener Actual'),
                calcularAlternativa(nuevoEspaciamiento, 'Propuesta del Especialista'),
                calcularAlternativa(1000, 'M√°ximo Ahorro')
            ];

            // 2. ANALIZAR CRITERIOS T√âCNICOS
            analizarCriteriosTecnicos(nuevoEspaciamiento);

            // 3. ANALIZAR IMPACTO EN OTROS √çTEMS WBS
            analizarImpactoOtrosItems(nuevoEspaciamiento);

            // 4. ANALIZAR RIESGOS DETALLADO
            analizarRiesgosDetallado(alternativas);

            // 5. MOSTRAR ARCHIVOS AFECTADOS
            mostrarArchivosAfectados();

            // 6. MOSTRAR ALTERNATIVAS
            mostrarAlternativas(alternativas, nuevoEspaciamiento);

            // 7. GENERAR RECOMENDACI√ìN DEL SISTEMA
            generarRecomendacion(alternativas);

            // 8. ACTUALIZAR RESUMEN EJECUTIVO
            const mejorAlternativa = alternativas.reduce((max, alt) => 
                parseFloat(alt.puntaje) > parseFloat(max.puntaje) ? alt : max
            );
            
            document.getElementById('ahorro-total').textContent = 
                `$${Math.abs(mejorAlternativa.ahorro).toLocaleString('es-CO')}`;
            document.getElementById('reduccion-porcentaje').textContent = 
                `${mejorAlternativa.porcentajeAhorro}%`;
            document.getElementById('archivos-afectados').textContent = item2_3_103.archivosAfectados.length;
            document.getElementById('riesgos-nuevos').textContent = mejorAlternativa.riesgos.length;

            // 9. MOSTRAR SECCI√ìN COMPLETA
            document.getElementById('alternativas-container').style.display = 'block';

            // 10. SCROLL AL RESULTADO
            document.getElementById('alternativas-container').scrollIntoView({ behavior: 'smooth' });
        }

        // AN√ÅLISIS DE CRITERIOS T√âCNICOS
        function analizarCriteriosTecnicos(nuevoEspaciamiento) {
            // Criterio 1: Norma UIT-T
            document.getElementById('criterio-propuesto').textContent = `${nuevoEspaciamiento}m`;
            document.getElementById('criterio-cumplimiento').innerHTML = 
                nuevoEspaciamiento <= 500 ? '‚úÖ Cumple' : '‚ö†Ô∏è Requiere validaci√≥n';
            document.getElementById('criterio-obs').textContent = 
                nuevoEspaciamiento <= 500 ? 'Dentro de l√≠mite UIT-T' : 'Supera l√≠mite, requiere validaci√≥n OTDR';

            // Criterio 2: Acceso vehicular
            document.getElementById('acceso-propuesto').textContent = 
                nuevoEspaciamiento >= 500 ? '‚úÖ Mejorado' : '‚ùå Similar';
            document.getElementById('acceso-cumplimiento').innerHTML = 
                nuevoEspaciamiento >= 500 ? '‚úÖ Bueno' : '‚ö†Ô∏è Dif√≠cil';
            document.getElementById('acceso-obs').textContent = 
                nuevoEspaciamiento >= 500 ? 'Mejor acceso para veh√≠culos de mantenimiento' : 'Sin mejora significativa';

            // Criterio 3: Localizaci√≥n de fallas
            const aumentoTiempo = ((nuevoEspaciamiento - 300) / 300 * 100).toFixed(0);
            document.getElementById('fallas-propuesto').textContent = 
                `‚è±Ô∏è +${aumentoTiempo}% tiempo`;
            document.getElementById('fallas-cumplimiento').innerHTML = 
                nuevoEspaciamiento <= 500 ? '‚ö†Ô∏è Aceptable' : '‚ùå Cr√≠tico';
            document.getElementById('fallas-obs').textContent = 
                `Aumento ${aumentoTiempo}% en tiempo de localizaci√≥n`;

            // Criterio 4: Costo-efectividad
            const ahorro = ((300 / nuevoEspaciamiento - 1) * 100).toFixed(1);
            document.getElementById('costo-propuesto').textContent = 
                `‚úÖ Mejora ${ahorro}%`;
            document.getElementById('costo-cumplimiento').innerHTML = '‚úÖ Excelente';
            document.getElementById('costo-obs').textContent = 
                `Reducci√≥n significativa de CAPEX`;
        }

        // AN√ÅLISIS DE IMPACTO EN OTROS √çTEMS
        function analizarImpactoOtrosItems(nuevoEspaciamiento) {
            const cantidadNueva = Math.round(datosProyecto.longitudCorredor * 1000 / nuevoEspaciamiento) + 88;
            const factorReduccion = cantidadNueva / item2_3_103.cantidadActual;

            const itemsRelacionados = [
                {
                    item: '2.3.104',
                    descripcion: 'Uniones r√°pidas',
                    cantidadActual: 6204,
                    formula: '3 uniones √ó cantidad cajas',
                    vuCOP: 35000
                },
                {
                    item: '2.3.108',
                    descripcion: 'Insumos fusionado',
                    cantidadActual: 6600,
                    formula: '3.2 fusiones √ó cantidad cajas',
                    vuCOP: 15000
                }
            ];

            const tbody = document.getElementById('impacto-otros-items');
            tbody.innerHTML = '';

            itemsRelacionados.forEach(item => {
                const cantNueva = Math.round(item.cantidadActual * factorReduccion);
                const costoActual = item.cantidadActual * item.vuCOP;
                const costoNuevo = cantNueva * item.vuCOP;
                const deltaCosto = costoNuevo - costoActual;

                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${item.item}</strong></td>
                    <td>${item.descripcion}<br><small style="color: #666;">${item.formula}</small></td>
                    <td>${item.cantidadActual.toLocaleString('es-CO')}</td>
                    <td><strong>${cantNueva.toLocaleString('es-CO')}</strong></td>
                    <td style="color: ${deltaCosto < 0 ? 'green' : 'red'}; font-weight: bold;">
                        ${deltaCosto < 0 ? '-' : '+'}$${Math.abs(deltaCosto).toLocaleString('es-CO')}
                    </td>
                `;
            });
        }

        // AN√ÅLISIS DE RIESGOS DETALLADO POR ALTERNATIVA
        function analizarRiesgosDetallado(alternativas) {
            const container = document.getElementById('analisis-riesgos-detallado');
            container.innerHTML = '';

            alternativas.forEach((alt, index) => {
                const div = document.createElement('div');
                div.style.background = 'white';
                div.style.padding = '15px';
                div.style.borderRadius = '8px';
                div.style.margin = '10px 0';
                div.style.border = alt.esPropuesta ? '2px solid var(--secondary-color)' : '1px solid #ddd';

                let riesgosHTML = '<table style="width: 100%; margin-top: 10px;"><tr><th>ID</th><th>Descripci√≥n</th><th>Prob</th><th>Impacto</th><th>Estrategia</th></tr>';

                // R-FIBRA-003 (siempre presente)
                riesgosHTML += `
                    <tr>
                        <td><strong>R-FIBRA-003</strong></td>
                        <td>Espaciamiento ${alt.espaciamiento === 300 ? 'muy corto' : 'optimizado'} ${alt.espaciamiento === 300 ? 'aumenta' : 'reduce'} CAPEX</td>
                        <td><span class="riesgo-badge ${alt.espaciamiento === 300 ? 'riesgo-alto' : 'riesgo-bajo'}">
                            ${alt.espaciamiento === 300 ? 'Alta' : 'Baja'}
                        </span></td>
                        <td><span class="riesgo-badge riesgo-alto">Alto</span></td>
                        <td>${alt.espaciamiento > 300 ? 'Mitigado' : 'Aceptar'}</td>
                    </tr>
                `;

                // R-FIBRA-006 (si espaciamiento > 300m)
                if (alt.espaciamiento > 300) {
                    const prob = alt.espaciamiento <= 500 ? 'Baja' : 'Media';
                    riesgosHTML += `
                        <tr>
                            <td><strong>R-FIBRA-006</strong></td>
                            <td>Mayor espaciamiento aumenta tiempo localizaci√≥n fallas (+${((alt.espaciamiento - 300) / 300 * 100).toFixed(0)}%)</td>
                            <td><span class="riesgo-badge riesgo-${prob === 'Baja' ? 'bajo' : 'medio'}">${prob}</span></td>
                            <td><span class="riesgo-badge riesgo-medio">Medio</span></td>
                            <td>${alt.espaciamiento <= 500 ? 'Aceptar' : 'Mitigar con OTDR'}</td>
                        </tr>
                    `;
                }

                // R-FIBRA-007 (si espaciamiento > 500m)
                if (alt.espaciamiento > 500) {
                    riesgosHTML += `
                        <tr>
                            <td><strong>R-FIBRA-007</strong></td>
                            <td>Posible degradaci√≥n se√±al en tramos largos sin punto de acceso</td>
                            <td><span class="riesgo-badge riesgo-medio">Media</span></td>
                            <td><span class="riesgo-badge riesgo-medio">Medio</span></td>
                            <td>Mitigar: Validaci√≥n OTDR obligatoria</td>
                        </tr>
                    `;
                }

                // R-FIBRA-008 (si espaciamiento < 500m)
                if (alt.espaciamiento < 500) {
                    riesgosHTML += `
                        <tr>
                            <td><strong>R-FIBRA-008</strong></td>
                            <td>Acceso a cajas cada ${alt.espaciamiento}m dificulta mantenimiento vehicular</td>
                            <td><span class="riesgo-badge riesgo-medio">Media</span></td>
                            <td><span class="riesgo-badge riesgo-medio">Medio</span></td>
                            <td>${alt.espaciamiento >= 500 ? 'Mitigado' : 'Aceptar'}</td>
                        </tr>
                    `;
                }

                riesgosHTML += '</table>';

                div.innerHTML = `
                    <h4>Alternativa ${index + 1}: ${alt.nombre} ${alt.esPropuesta ? '‚≠ê (TU PROPUESTA)' : ''}</h4>
                    <p><strong>Espaciamiento:</strong> ${alt.espaciamiento}m | <strong>Cantidad:</strong> ${alt.cantidad} cajas</p>
                    ${riesgosHTML}
                `;

                container.appendChild(div);
            });
        }

        // MOSTRAR ARCHIVOS QUE SE ACTUALIZAR√ÅN
        function mostrarArchivosAfectados() {
            const tbody = document.getElementById('archivos-actualizar');
            tbody.innerHTML = '';

            item2_3_103.archivosAfectados.forEach(archivo => {
                const row = tbody.insertRow();
                const versionActual = archivo.archivo.includes('V.3') ? 'v2.0' : 
                                     archivo.archivo.includes('37_Memorias') ? 'v5.0' : 'v5.0';
                const versionNueva = versionActual.replace(/(\d+)\.(\d+)/, (m, p1, p2) => `${p1}.${parseInt(p2) + 1}`);
                
                row.innerHTML = `
                    <td><code>${archivo.archivo}</code></td>
                    <td>Carpetas I-VI</td>
                    <td>${archivo.seccion}</td>
                    <td><span class="modificable-badge" style="font-size: 0.8em;">
                        ${archivo.archivo.includes('WBS') ? 'Costos' : 
                          archivo.archivo.includes('Memorias') ? 'Especificaciones' : 
                          archivo.archivo.includes('Sistema') ? 'Criterios' : 'Cantidades'}
                    </span></td>
                    <td>${versionActual} ‚Üí <strong>${versionNueva}</strong></td>
                `;
            });

            // Nota sobre Carpeta X
            const rowX = tbody.insertRow();
            rowX.innerHTML = `
                <td><code>X/SISTEMA_02_Telecomunicaciones_Master.md</code></td>
                <td>Carpeta X</td>
                <td>Secci√≥n 5.2.3</td>
                <td><span class="no-modificable-badge" style="font-size: 0.8em;">Consolidado</span></td>
                <td>‚è≥ Snapshot mensual</td>
            `;
            rowX.style.background = '#fff3e0';
        }

        // GENERAR RECOMENDACI√ìN DEL SISTEMA
        function generarRecomendacion(alternativas) {
            const mejorAlternativa = alternativas.reduce((max, alt) => 
                parseFloat(alt.puntaje) > parseFloat(max.puntaje) ? alt : max
            );

            const container = document.getElementById('recomendacion-sistema');
            
            container.innerHTML = `
                <h3>üéØ Recomendaci√≥n del Sistema</h3>
                <div style="font-size: 1.2em; margin: 15px 0;">
                    <strong>RECOMENDACI√ìN:</strong> 
                    <span style="color: var(--success-color); font-size: 1.3em;">
                        ‚úÖ APROBAR ALTERNATIVA "${mejorAlternativa.nombre.toUpperCase()}"
                    </span>
                </div>
                
                <p><strong>Puntaje:</strong> ${mejorAlternativa.puntaje}/10 (Mayor de las 3 alternativas)</p>
                <p><strong>Espaciamiento:</strong> ${mejorAlternativa.espaciamiento}m</p>
                <p><strong>Ahorro:</strong> $${Math.abs(mejorAlternativa.ahorro).toLocaleString('es-CO')} COP (${mejorAlternativa.porcentajeAhorro}%)</p>
                
                <h4 style="margin-top: 15px;">üìã Justificaci√≥n:</h4>
                <ul>
                    <li>${mejorAlternativa.espaciamiento <= 500 ? '‚úÖ' : '‚ö†Ô∏è'} Cumple norma UIT-T ${mejorAlternativa.espaciamiento <= 500 ? 'estrictamente' : 'con validaci√≥n'}</li>
                    <li>‚úÖ Balance √≥ptimo entre ahorro y riesgo t√©cnico</li>
                    <li>‚úÖ Riesgos identificados son ${mejorAlternativa.riesgos.length <= 2 ? 'manejables' : 'm√∫ltiples pero mitigables'}</li>
                    <li>${mejorAlternativa.ahorro > 1000000000 ? '‚úÖ' : '‚ö†Ô∏è'} Ahorro significativo en CAPEX</li>
                </ul>

                <h4 style="margin-top: 15px;">‚ö†Ô∏è Condiciones de Aprobaci√≥n:</h4>
                <ul>
                    ${mejorAlternativa.espaciamiento > 500 ? '<li>üî¨ Realizar validaci√≥n OTDR antes de implementar</li>' : ''}
                    <li>üìù Actualizar criterios en CRITERIOS_TECNICOS_MAESTRO_v1.0.md</li>
                    <li>‚ö†Ô∏è Agregar ${mejorAlternativa.riesgos.length} riesgos a MATRIZ_RIESGOS_PMO_AMPLIADA</li>
                    <li>üìÅ Actualizar ${item2_3_103.archivosAfectados.length} archivos en carpetas I-VI</li>
                </ul>
            `;
        }

        function calcularAlternativa(espaciamiento, nombre) {
            const cantidadBase = Math.round(datosProyecto.longitudCorredor * 1000 / espaciamiento);
            const nodosAdicionales = 88; // Fijos, no se reducen
            const cantidadTotal = cantidadBase + nodosAdicionales;
            const costo = cantidadTotal * datosProyecto.precioUnitarioCaja;
            const ahorro = item2_3_103.costoActual - costo;
            const porcentajeAhorro = ((ahorro / item2_3_103.costoActual) * 100).toFixed(1);

            // CALCULAR PUNTAJE (matriz de decisi√≥n simplificada)
            let puntaje = 0;
            
            // Costo (30%)
            const costoScore = espaciamiento > 300 ? 9 : 7;
            puntaje += costoScore * 0.3;
            
            // Cumplimiento t√©cnico (25%)
            const tecnicoScore = espaciamiento <= 500 ? 9 : (espaciamiento <= 1000 ? 7 : 5);
            puntaje += tecnicoScore * 0.25;
            
            // Facilidad construcci√≥n (20%)
            const construccionScore = espaciamiento >= 500 ? 9 : 6;
            puntaje += construccionScore * 0.2;
            
            // Mantenibilidad (15%)
            const mantenimientoScore = espaciamiento >= 500 ? 8 : 6;
            puntaje += mantenimientoScore * 0.15;
            
            // Riesgo t√©cnico (10%)
            const riesgoScore = espaciamiento <= 500 ? 9 : (espaciamiento <= 1000 ? 7 : 5);
            puntaje += riesgoScore * 0.1;

            // Identificar riesgos
            let riesgos = ['R-FIBRA-003']; // Siempre presente (CAPEX)
            if (espaciamiento > 300) riesgos.push('R-FIBRA-006'); // Localizaci√≥n fallas
            if (espaciamiento > 500) riesgos.push('R-FIBRA-007'); // Degradaci√≥n se√±al

            return {
                nombre: nombre,
                espaciamiento: espaciamiento,
                cantidad: cantidadTotal,
                costo: costo,
                ahorro: ahorro,
                porcentajeAhorro: porcentajeAhorro,
                puntaje: puntaje.toFixed(1),
                riesgos: riesgos,
                esActual: espaciamiento === 300,
                esPropuesta: espaciamiento === parseInt(document.getElementById('nuevo-espaciamiento').value)
            };
        }

        function mostrarAlternativas(alternativas, espaciamientoPropuesto) {
            const grid = document.getElementById('alternatives-grid');
            grid.innerHTML = '';

            // Actualizar resumen
            const mejorAlternativa = alternativas.reduce((max, alt) => 
                parseFloat(alt.puntaje) > parseFloat(max.puntaje) ? alt : max
            );
            
            document.getElementById('ahorro-total').textContent = 
                `$${Math.abs(mejorAlternativa.ahorro).toLocaleString('es-CO')}`;
            document.getElementById('reduccion-porcentaje').textContent = 
                `${mejorAlternativa.porcentajeAhorro}%`;

            // Generar cards de alternativas
            alternativas.forEach(alt => {
                const card = document.createElement('div');
                card.className = 'alternative-card' + (parseFloat(alt.puntaje) === parseFloat(mejorAlternativa.puntaje) ? ' recommended' : '');
                
                card.innerHTML = `
                    <h3>${alt.nombre} ${alt.esPropuesta ? '‚≠ê' : ''} ${parseFloat(alt.puntaje) === parseFloat(mejorAlternativa.puntaje) ? '(RECOMENDADA)' : ''}</h3>
                    <div class="score">${alt.puntaje}/10</div>
                    
                    <h4 style="margin-top: 15px;">üìê Especificaci√≥n:</h4>
                    <p>Espaciamiento: <strong>${alt.espaciamiento}m</strong></p>
                    <p>Cantidad: <strong>${alt.cantidad} cajas</strong></p>
                    <p>Costo: <strong>$${alt.costo.toLocaleString('es-CO')} COP</strong></p>
                    
                    <h4 style="margin-top: 15px;">üí∞ Impacto Econ√≥mico:</h4>
                    <p style="color: ${alt.ahorro > 0 ? 'green' : 'red'}; font-weight: bold;">
                        ${alt.ahorro > 0 ? 'Ahorro' : 'Sobrecosto'}: 
                        $${Math.abs(alt.ahorro).toLocaleString('es-CO')} COP 
                        (${Math.abs(alt.porcentajeAhorro)}%)
                    </p>
                    
                    <h4 style="margin-top: 15px;">‚ö†Ô∏è Riesgos:</h4>
                    ${alt.riesgos.map(r => `<span class="riesgo-badge riesgo-medio">${r}</span>`).join(' ')}
                    
                    <h4 style="margin-top: 15px;">‚úÖ Ventajas:</h4>
                    ${generarVentajas(alt.espaciamiento)}
                    
                    <h4 style="margin-top: 15px;">‚ùå Desventajas:</h4>
                    ${generarDesventajas(alt.espaciamiento)}
                `;
                
                grid.appendChild(card);
            });
        }

        function generarVentajas(espaciamiento) {
            if (espaciamiento === 300) {
                return `<ul>
                    <li>Cumple norma estrictamente</li>
                    <li>F√°cil localizaci√≥n de fallas</li>
                    <li>Menor tiempo de reparaci√≥n</li>
                </ul>`;
            } else if (espaciamiento === 500) {
                return `<ul>
                    <li>Cumple UIT-T (l√≠mite 500m)</li>
                    <li>Reduce CAPEX 42.5%</li>
                    <li>Mejor acceso vehicular</li>
                    <li>Menor puntos de falla</li>
                </ul>`;
            } else {
                return `<ul>
                    <li>M√°ximo ahorro CAPEX (71%)</li>
                    <li>M√≠nimo puntos de falla</li>
                    <li>√ìptimo acceso vehicular</li>
                </ul>`;
            }
        }

        function generarDesventajas(espaciamiento) {
            if (espaciamiento === 300) {
                return `<ul>
                    <li>Alto CAPEX</li>
                    <li>Dif√≠cil acceso vehicular</li>
                    <li>M√°s puntos de falla potenciales</li>
                </ul>`;
            } else if (espaciamiento === 500) {
                return `<ul>
                    <li>Mayor distancia para localizar fallas (+66%)</li>
                    <li>Requiere coordinaci√≥n de accesos</li>
                </ul>`;
            } else {
                return `<ul>
                    <li>Requiere validaci√≥n OTDR especial</li>
                    <li>Mayor tiempo localizaci√≥n fallas</li>
                    <li>Supera recomendaci√≥n UIT-T est√°ndar</li>
                </ul>`;
            }
        }

        function recargarRiesgos(itemId) {
            // SIMULA lectura de MATRIZ_RIESGOS_PMO_AMPLIADA_v1.0.md
            alert('üîÑ Recargando riesgos desde:\n\nVIII/Matrices_Dependencias/MATRIZ_RIESGOS_PMO_AMPLIADA_v1.0.md\n\n‚úÖ Riesgos actualizados (simulado)');
            
            // En implementaci√≥n real, leer archivo JSON generado desde la matriz
            // fetch('riesgos_item_2-3-103.json').then(...)
        }

        function enviarAprobacion() {
            const observacion = document.getElementById('observacion-texto').value;
            const nuevoEspaciamiento = document.getElementById('nuevo-espaciamiento').value;
            
            const mensaje = `
üì® AN√ÅLISIS GENERADO Y ENVIADO A PMO

Archivo generado: DT-FIBRA-001_Espaciamiento_Cajas_v1.0.md
Ubicaci√≥n: II/Decisiones_Tecnicas/

An√°lisis generado: AC-FIBRA-001_An√°lisis_v1.0.md

Contenido:
- Observaci√≥n del especialista: "${observacion}"
- Par√°metro propuesto: ${nuevoEspaciamiento}m
- 3 alternativas calculadas
- Impacto en 5 archivos identificado
- Riesgos nuevos listados

Estado: üü° Pendiente aprobaci√≥n PMO

Se notificar√° por email cuando PMO revise.
            `;
            
            alert(mensaje);
            cerrarModal();
        }

        function ejecutarCambio() {
            const nuevoEspaciamiento = parseInt(document.getElementById('nuevo-espaciamiento').value);
            
            if (!confirm('‚ö†Ô∏è CONFIRMAR EJECUCI√ìN\n\nEsto actualizar√° 5 archivos en carpetas I-VI.\n¬øContinuar?')) {
                return;
            }

            const mensaje = `
‚úÖ CAMBIO EJECUTADO EXITOSAMENTE

DECISI√ìN T√âCNICA:
- DT-FIBRA-001 v2.0 (Aprobada)
- Espaciamiento: 300m ‚Üí ${nuevoEspaciamiento}m

ARCHIVOS ACTUALIZADOS (4 en I-VI):
‚úÖ V.3_Sistemas_Comunicacion_Detalle.md ‚Üí v2.1
‚úÖ WBS_Presupuestal_v3.0.md ‚Üí Recalculado
‚úÖ IV/37_Memorias_Diseno_Basico.md ‚Üí v5.1
‚úÖ III/28_Sistema_FibraOptica_Integrado.md ‚Üí v5.1

PENDIENTE SNAPSHOT MENSUAL:
‚è≥ X/SISTEMA_02_Master.md (se actualiza en consolidaci√≥n mensual)

RIESGOS ACTUALIZADOS:
‚úÖ Agregados a MATRIZ_RIESGOS_PMO_AMPLIADA
- R-FIBRA-006 (con Origen_Decisi√≥n: DT-FIBRA-001)

AHORRO REALIZADO:
üí∞ $${calcularAlternativa(nuevoEspaciamiento, '').ahorro.toLocaleString('es-CO')} COP

Ver detalles en: II/Decisiones_Tecnicas/DT-FIBRA-001_v2.0.md
            `;
            
            alert(mensaje);
            
            // Actualizar valores en pantalla
            document.getElementById('cantidad-cajas').innerHTML = 
                `<strong>${calcularAlternativa(nuevoEspaciamiento, '').cantidad} unidades</strong> <span style="color: green;">(Actualizado ‚úÖ)</span>`;
            document.getElementById('total-cajas').innerHTML = 
                `<strong>$${calcularAlternativa(nuevoEspaciamiento, '').costo.toLocaleString('es-CO')}</strong> <span style="color: green;">(Actualizado ‚úÖ)</span>`;
            
            cerrarModal();
        }

        // FUNCI√ìN PARA RECARGAR RIESGOS DESDE MATRIZ (BIDIRECCIONAL)
        function recargarRiesgosDesdeMatriz() {
            // En implementaci√≥n real:
            // 1. Leer VIII/Matrices_Dependencias/MATRIZ_RIESGOS_PMO_AMPLIADA_v1.0.md
            // 2. Filtrar riesgos donde columna "Relacionado_Item_WBS" === "2.3.103"
            // 3. Actualizar div #riesgos-2-3-103
            
            console.log('Recargando riesgos desde MATRIZ_RIESGOS_PMO_AMPLIADA_v1.0.md...');
        }

        // AUTO-RECARGAR RIESGOS CADA 30 SEGUNDOS (Opcional)
        // setInterval(recargarRiesgosDesdeMatriz, 30000);
    </script>
</body>
</html>

